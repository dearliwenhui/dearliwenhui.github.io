<html><head><meta charset="utf-8"><title>23 更快、更高、更强的 Nginx-慕课专栏</title>
			<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
			<meta name="renderer" content="webkit">
			<meta property="qc:admins" content="77103107776157736375">
			<meta property="wb:webmaster" content="c4f857219bfae3cb">
			<meta http-equiv="Access-Control-Allow-Origin" content="*">
			<meta http-equiv="Cache-Control" content="no-transform ">
			<meta http-equiv="Cache-Control" content="no-siteapp">
			<link rel="apple-touch-icon" sizes="76x76" href="https://www.imooc.com/static/img/common/touch-icon-ipad.png">
			<link rel="apple-touch-icon" sizes="120x120" href="https://www.imooc.com/static/img/common/touch-icon-iphone-retina.png">
			<link rel="apple-touch-icon" sizes="152x152" href="https://www.imooc.com/static/img/common/touch-icon-ipad-retina.png">
			<link href="https://moco.imooc.com/captcha/style/captcha.min.css" rel="stylesheet">
			<link rel="stylesheet" href="https://www.imooc.com/static/moco/v1.0/dist/css/moco.min.css?t=201907021539" type="text/css">
			<link rel="stylesheet" href="https://www.imooc.com/static/lib/swiper/swiper-3.4.2.min.css?t=201907021539">
			<link rel="stylesheet" href="https://static.mukewang.com/static/css/??base.css,common/common-less.css?t=2.5,column/zhuanlanChapter-less.css?t=2.5,course/inc/course_tipoff-less.css?t=2.5?v=201907051055" type="text/css">
			<link charset="utf-8" rel="stylesheet" href="https://www.imooc.com/static/lib/ueditor/themes/imooc/css/ueditor.css?v=201907021539"><link rel="stylesheet" href="https://www.imooc.com/static/lib/baiduShare/api/css/share_style0_16.css?v=6aba13f0.css"></head>
			<body><div id="main">


<div class="main-con hide-menu">
    <!-- 左侧菜单 & 索引 -->
    
    <div class="right-content" style="padding-left: 0px;">
        <div class="container clearfix" id="top" style="width: 1134px; display: block;">
            
            
            <div class="center_con js-center_con l" style="width: 1134px;">
                <div class="article-con">
                                            <!-- 买过的阅读 -->
                        

                    
                    <div class="art-title" style="margin-top: 0px;">
                        23 更快、更高、更强的 Nginx
                    </div>
                    <div class="art-info clearfix">
                        
                        <span class="l">
                            更新时间：2020-02-28 10:36:28
                        </span>
                    </div>
                    <div class="art-top">
                                                <img src="https://img3.sycdn.imooc.com/5e587c770001752d06400346.jpg" alt="">
                                                                        <div class="famous-word-box">
                            <img src="https://www.imooc.com/static/img/column/bg-l.png" alt="" class="bg1 bg">
                            <img src="https://www.imooc.com/static/img/column/bg-r.png" alt="" class="bg2 bg">
                            <div class="famous-word">世界上最宽阔的是海洋，比海洋更宽阔的是天空，比天空更宽阔的是人的胸怀。——雨果<p></p></div>
                        </div>
                                            </div>
                    <div class="art-content js-lookimg">
                        <div id="article_content">
                            <div class="cl-preview-section"><h3 id="前言">前言</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们在上一篇文章中介绍了如何通过<code>gzip</code>命令来减小传输体积，减小数据传输时间，提升用户体验。<br>
<code>Nginx</code>还有很多其他的参数可以提高响应速度，改善用户体验，我们在本篇文章中简单的介绍几个最常用优化指令。</p>
</div><div class="cl-preview-section"><h3 id="优化措施">优化措施</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">一位<code>伟人</code>曾经说过；</p>
</div><div class="cl-preview-section"><blockquote>
<p style="font-size: 20px; line-height: 38px;">没有任何性能问题是增加一台机器解决不了的，如果还没有结局，那就再增加一台。</p>
</blockquote>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">但是增加一台机器会带来很大的财务压力以及运维压力，我们更希望从软件本身方便进行优化，最大力度的榨干服务器性能，降低硬件成本和运维成本。<br>
我们从以下几个方面来介绍常用的优化措施：<br>
<img class="" src="https://img1.sycdn.imooc.com/5e587c990001573d17501070.png" data-original="//img1.sycdn.imooc.com/5e587c990001573d17501070.png" alt="图片描述"></p>
</div><div class="cl-preview-section"><h4 id="cpu优化" style="font-size: 26px;"><code>CPU</code>优化</h4>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们可以通过修改<code>Nginx</code>中<code>CPU</code>相关指令来提升服务器的性能。<br>
这里主要涉及到两个指令，分别是<code>worker_processes</code>和<code>worker_cpu_affinity</code>指令。</p>
</div><div class="cl-preview-section"><h5 id="worker_processes指令" style="font-size: 20px; line-height: 38px;"><code>worker_processes</code>指令</h5>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这个指令用来设置<code>Nginx</code>的<code>worker</code>进程数量。我们在本系列文章的开始时候就介绍过，<code>Nginx</code>是一种<code>Master-Worker</code>机制，真正干活的是<code>worker</code>进程，所以适当的提高<code>worker</code>进程的数量，可以提高服务器处理请求的速度。但是<code>worker</code>进程的数量也不是越多越好，<code>worker</code>进程数量太多的话会增加<code>CPU</code>切换进程的负担，一般建议设置为和当前服务器核心数量相同。</p>
</div><div class="cl-preview-section"><h5 id="worker_cpu_affinity指令" style="font-size: 20px; line-height: 38px;"><code>worker_cpu_affinity</code>指令</h5>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img class="" src="https://img1.sycdn.imooc.com/5e587ca30001ddd213660456.png" data-original="//img1.sycdn.imooc.com/5e587ca30001ddd213660456.png" alt="图片描述"><br>
我们先看一下<code>affinity</code>的意思是<code>亲和力</code>。那么<code>cpu_affinity</code>就是<code>cpu亲和力</code>。那么什么是<code>cpu亲和力</code>呢？<br>
这个概念是对于进程来说的。我们知道，在现代的多核处理器上面，<code>OS</code>在多次调度同一个进程的时候，可能将进程分配到不同的处理器上面进行处理，这样就可能导致进程的缓存不可用，会增加进程执行的时间。所以就产生了<code>cpu亲和力</code>这个东西，这个功能可以把一个进程和一个处理核绑定在一起，这样就可以充分利用<code>CPU</code>的缓存，提高缓存命中率，加快进程的执行速度。<br>
它的值是一个二进制，对应物理核心数量，置<code>1</code>的那一位表示绑定到该物理核。<br>
<code>worker_cpu_affinity 00000001 00000010 00000100 00001000 00010000 00100000 01000000 10000000</code></p>
</div><div class="cl-preview-section"><h4 id="缓存控制" style="font-size: 26px;">缓存控制</h4>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">对于任何一个优秀的软件来说，都离不开缓存<code>buffer</code>。在<code>Nginx</code>中对<code>buffer</code>处理的方法都比较一致，一般情况下我们设置单个<code>buffer</code>的大小以及使用<code>buffer</code>的数量。如果单个<code>buffer</code>不够，那么继续分配<code>buffer</code>，直到达到指定数量。如果还不够，还可能使用临时文件来保存。这里就要尽量的避免开辟临时文件，这样可以保证所有的内容都保存在内存中，可以提高响应速度。<br>
我们要合理的评估相关内容的大小，分配适应的缓存。<br>
和<code>buffer</code>相关的几个常用配置指令如下：</p>
</div><div class="cl-preview-section"><ul>
<li style="font-size: 20px; line-height: 38px;"><code>client_max_body_size</code>:客户端请求服务器最大的<code>body</code>大小</li>
<li style="font-size: 20px; line-height: 38px;"><code>client_body_buffer_size</code>:<code>Nginx</code>分配给请求数据的<code>Buffe</code>r大小，如果请求的数据小于<code>client_body_buffer_size</code>直接将数据先在内存中存储。如果请求的值大于<code>client_body_buffer_size</code>小于<code>client_max_body_size</code>，就会将数据先存储到临时文件中</li>
<li style="font-size: 20px; line-height: 38px;"><code>client_header_buffer_size</code>: 指定用于请求<code>header</code>的缓存区大小<br>
此外还有很多类似的<code>buffer</code>大小，功能都是大同小异。</li>
</ul>
</div><div class="cl-preview-section"><h4 id="超时时间" style="font-size: 26px;">超时时间</h4>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这个时间用于控制一些时间参数，比如从客户端接收请求头的时间，接收请求体的时间，反向代理服务器接收请求内容的时间等等。通过对他们设置一些合理的值，可以让一些请求直接结束。<br>
常用的超时时间有下面几个：<br>
<code>client_body_timeout</code> : 客户端和服务器建立连接之后接收一个完整<code>body</code>体的时间。<br>
<code>client_header_timeout</code>: 服务器接收一个完整的请求<code>header</code>的时间</p>
</div><div class="cl-preview-section"><h3 id="总结">总结</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><code>Nginx</code>还有很多优化的参数，但是总体上可以分为上面几类，大家在使用的过程中要多多总结，多多领会。</p>
</div>}
                        </div>
                    </div>
                                            <!-- 买过的阅读 -->
                        <div class="art-next-prev clearfix">
                                                                                                <!-- 已买且开放 或者可以试读 -->
                                    <a href="/read/57/article/1602">
                                                                    <div class="prev l clearfix">
                                        <div class="icon l">
                                            <i class="imv2-arrow3_l"></i>
                                        </div>
                                        <p>
                                            22 压缩压缩再压缩
                                        </p>
                                    </div>
                                </a>
                                                                                                                            <!-- 已买且开放 或者可以试读 -->
                                    <a href="/read/57/article/1624">
                                                                    <div class="next r clearfix">
                                        <p>
                                            24 Nginx 的内核参数优化
                                        </p>
                                        <div class="icon r">
                                            <i class="imv2-arrow3_r"></i>
                                        </div>

                                    </div>
                                </a>
                                                    </div>
                                    </div>
                <div class="comments-con js-comments-con" id="coments_con">
                </div>

                
            </div>
            
            
            

        </div>
    </div>
</div>

<div class="modal modal-jiaQun-new hide" id="modal-jiaQun">
    <div class="inner" style="">
        <div class="modal-close js-close-jiaQun">
            <i class="imv2-close"></i>
        </div>
        <div class="content">
            <img src="https://img1.sycdn.imooc.com/5f1a80c50001c9a105340522.jpg">
            <div class="right-info">
                <div class="title">
                    扫码加入慕课Java核心用户群
                </div>
                <div class="desc">
                                            <p class="mb6">验证信息：<span id="joincode">2011161453536434</span><span class="copy js-copy-joincode">复制</span></p>
                                        <p class="mb6">QQ讨论群号：314316732</p>
                                            <p>QQ群URL：<a href="https://jq.qq.com/?_wv=1027&amp;k=OouwHZGZ" target="_blank">点击访问</a></p>
                                    </div>
            </div>
            <p class="tip">若遇到搜索不到QQ群或加群失败，请联系客服邮箱:kf@imooc.com</p>
        </div>
    </div>
</div>
 
<!-- 专栏介绍页专栏评价 -->

<!-- 专栏介绍页底部三条评价 -->

<!-- 专栏阅读页弹层目录和介绍页页面目录 -->

<!-- 专栏阅读页发布回复 -->

<!-- 专栏阅读页发布评论 -->

<!-- 专栏阅读页底部评论 -->

<!-- 专栏阅读 单个 评论 -->

<!-- 新增回复和展开三条以外回复 -->

<!-- 立即订阅的弹窗 -->












</div></body></html>