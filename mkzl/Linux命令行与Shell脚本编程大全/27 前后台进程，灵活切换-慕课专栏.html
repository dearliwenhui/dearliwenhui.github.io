<html><head><meta charset="utf-8"><title>27 前后台进程，灵活切换-慕课专栏</title>
			<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
			<meta name="renderer" content="webkit">
			<meta property="qc:admins" content="77103107776157736375">
			<meta property="wb:webmaster" content="c4f857219bfae3cb">
			<meta http-equiv="Access-Control-Allow-Origin" content="*">
			<meta http-equiv="Cache-Control" content="no-transform ">
			<meta http-equiv="Cache-Control" content="no-siteapp">
			<link rel="apple-touch-icon" sizes="76x76" href="https://www.imooc.com/static/img/common/touch-icon-ipad.png">
			<link rel="apple-touch-icon" sizes="120x120" href="https://www.imooc.com/static/img/common/touch-icon-iphone-retina.png">
			<link rel="apple-touch-icon" sizes="152x152" href="https://www.imooc.com/static/img/common/touch-icon-ipad-retina.png">
			<link href="https://moco.imooc.com/captcha/style/captcha.min.css" rel="stylesheet">
			<link rel="stylesheet" href="https://www.imooc.com/static/moco/v1.0/dist/css/moco.min.css?t=201907021539" type="text/css">
			<link rel="stylesheet" href="https://www.imooc.com/static/lib/swiper/swiper-3.4.2.min.css?t=201907021539">
			<link rel="stylesheet" href="../zhuanlanChapter-less.css?v=201907051055" type="text/css">
			<link charset="utf-8" rel="stylesheet" href="https://www.imooc.com/static/lib/ueditor/themes/imooc/css/ueditor.css?v=201907021539"><link rel="stylesheet" href="https://www.imooc.com/static/lib/baiduShare/api/css/share_style0_16.css?v=6aba13f0.css"></head>
			<body><div id="main">

<div class="container clearfix" id="top" style="display: block; width: 1134px;">
    
    <div class="center_con js-center_con l" style="width: 1134px;">
        <div class="article-con">
                            <!-- 买过的阅读 -->
                <div class="map">
                    <a href="/read" target="_blank"><i class="imv2-feather-o"></i></a>
                    <a href="/read/39" target="_blank">Linux命令行与Shell脚本编程大全</a>
                    <a href="" target="_blank">
                        <span>
                            / 3-6 27 前后台进程，灵活切换
                        </span>
                    </a>
                </div>

            


            <div class="art-title" style="margin-top: 0px;">
                27 前后台进程，灵活切换
            </div>
            <div class="art-info">
                
                <span>
                    更新时间：2019-07-20 17:23:36
                </span>
            </div>
            <div class="art-top">
                                <img src="https://img4.mukewang.com/5d2c1e380001bd8606400359.jpg" alt="">
                                                <div class="famous-word-box">
                    <img src="https://www.imooc.com/static/img/column/bg-l.png" alt="" class="bg1 bg">
                    <img src="https://www.imooc.com/static/img/column/bg-r.png" alt="" class="bg2 bg">
                    <div class="famous-word">受苦的人，没有悲观的权利。<p class="author">——尼采</p></div>
                </div>
                            </div>
            <div class="art-content js-lookimg">
                <div><div class="cl-preview-section"><h2 id="内容简介" style="font-size: 30px;">内容简介</h2>
</div><div class="cl-preview-section"><ol>
<li style="font-size: 20px; line-height: 38px;">前言</li>
<li style="font-size: 20px; line-height: 38px;">&amp; 符号和 nohup 命令：后台运行进程</li>
<li style="font-size: 20px; line-height: 38px;">Ctrl + Z，jobs，bg 和 fg 命令：控制进程的前后台切换</li>
<li style="font-size: 20px; line-height: 38px;">总结</li>
</ol>
</div><div class="cl-preview-section"><h2 id="前言" style="font-size: 30px;">1. 前言</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">上一课进程操作和系统重启 中，我们简单介绍了进程，也学习了如何列出系统中的进程，如何过滤列表结果，如何结束进程。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这一课我们继续乘胜追击，“一路向北”，来学习进程的后台运行。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们使用的终端让我们难免有一种感觉：我们每次只能在一个终端中运行一个进程。但其实这是大错特错的。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">终端还可以运行后台进程。要使一个进程在后台运行，有几种方法，我们都将学习一下。</p>
</div><div class="cl-preview-section"><h2 id="符号和-nohup-命令：后台运行进程" style="font-size: 30px;">2. &amp; 符号和 nohup 命令：后台运行进程</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们到目前为止用终端做的事情都是目所能及的，也就是说：我们运行的命令都是在前台可见的。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这样的一个好处是我们可以看到命令运行的过程，有什么问题可以及时发现。但是也有缺陷，例如有的命令运行耗时良久，我们又不想无所事事，怎么办呢？难道我开一个终端专门执行一个耗时命令，然后为了能做其他事情，我再启动一个终端，那也很不方便。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">而且，这样的规避方法在非图形界面的终端（还记得我们的 tty2 ~ tty6吗？ 注：新版 Ubuntu 是这样的，旧版的 Ubuntu 是 tty1 ~ tty6 ）中是难以实现的，因为只有一个终端窗口。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">所以这课显得尤为重要。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">事实上，我们可以在同一个终端中同时运行好几个命令。怎么做呢？就需要用到后台进程的概念。</p>
</div><div class="cl-preview-section"><h4 id="前台进程和后台进程" style="font-size: 26px;">前台进程和后台进程</h4>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">默认情况下，用户创建的进程都是前台进程。前台进程从键盘读取数据，并把处理结果输出到显示器。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们可以看到前台进程的运行过程。例如，使用 ls 命令来遍历当前目录下的文件。</p>
</div><div class="cl-preview-section"><pre><code>ls
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这个程序就运行在前台，它会直接把结果输出到显示器。如果 ls 命令需要数据（实际上不需要），那么它会等待用户从键盘输入。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">当程序运行在前台时，由于命令提示符（$）还未出现，用户不能输入其他命令；即使程序需要运行很长时间，也必须等待程序运行结束才能输入其他命令。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">后台进程与键盘没有必然的关系。当然，后台进程也可能会等待键盘输入。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">后台进程的优点是不必等待程序运行结束就可以输入其他命令。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">那么怎么使一个进程（程序的实例）运行在后台呢？</p>
</div><div class="cl-preview-section"><h4 id="符号：在后台运行进程" style="font-size: 26px;">&amp; 符号：在后台运行进程</h4>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">前面说过，让一个进程在后台运行有几种方法。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们带大家来学习第一种，很简单：就是在你要运行的命令最后加上 &amp; 这个符号。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们可以用熟悉的 cp 命令做例子。例如，我运行 cp 命令来拷贝文件：emacs 的软件包。当然了，你可以用其他文件来测试。</p>
</div><div class="cl-preview-section"><pre><code>cp emacs-26.2.tar.gz emacs-26.2-copy.tar.gz &amp;
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d27ecd70001d47617740302.png" alt="图片描述" data-original="http://img.mukewang.com/5d27ecd70001d47617740302.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">上图中，因为命令最后加了 &amp; 符号，运行时此进程就成为了后台进程。终端输出了一些信息：</p>
</div><div class="cl-preview-section"><pre><code>[1] 2051
</code></pre>
</div><div class="cl-preview-section"><ul>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">[1] ：这是此终端的后台进程的标号。因为这是第一个后台进程，所以标号为 1。</p>
</li>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">2051 ：这是进程号（PID），如果你想要结束这个后台进程，你可以用我们上一课学习的 kill 命令：</p>
<pre><code>kill 2051
</code></pre>
</li>
</ul>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们虽然看不到这个拷贝进程的“所作所为”，但它确实在后台默默进行着文件的拷贝。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">因为这个 emacs 的软件包不大，就几十 MB，所以几乎是瞬间就拷贝完毕了。可以用 ls 命令来看看：</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d27ecdf000151d619620772.png" alt="图片描述" data-original="http://img.mukewang.com/5d27ecdf000151d619620772.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">可以看到，终端显示了：</p>
</div><div class="cl-preview-section"><pre><code>[1]+  Done    cp emacs-26.2.tar.gz emacs-26.2-copy.tar.gz
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">Done 是英语“完成的”的意思，表示这个后台进程的任务已经完成了。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">如果我们用其他命令试一下，例如 find 命令，你也许会比较吃惊。例如，我们运行：</p>
</div><div class="cl-preview-section"><pre><code>sudo find / -name "*log" &amp;
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">意思是：以 root 身份在根目录 / 下查找所有以 log 结尾的文件名的文件，并且在后台运行此进程。在前面加 sudo 是为了防止出现太多 Permission denied 的警告。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d27ece80001436720521326.png" alt="图片描述" data-original="http://img.mukewang.com/5d27ece80001436720521326.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">可以看到，这次 find 命令的这个后台进程的进程号是 2060。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">你会发现，find 命令虽然在后台运行了，但是终端还是会不断显示所有找到的内容或错误信息。虽然我们还可以在终端中输入其他命令，但是一直会跳出 find 搜索的结果，还是很让人感到厌烦的。最后我不得不把它停止（可以用 Ctrl + C 组合键。或者你用 <code>kill 2060</code> 也可以）。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d27ecef0001c5c519061364.png" alt="图片描述" data-original="http://img.mukewang.com/5d27ecef0001c5c519061364.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">幸好，我们之前学过重定向，我们可以把 find 的输出结果重定向到文件里，就不会再来烦我们了。</p>
</div><div class="cl-preview-section"><pre><code>sudo find / -name "*log" &gt; output_find &amp;
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这样就不会一直有信息输出了。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">当然了，我们还可以更保险一些，将标准错误输出也重定向到同一个文件，这样就不会有任何输出了。</p>
</div><div class="cl-preview-section"><pre><code>sudo find / -name "*log" &gt; output_find 2&gt;&amp;1 &amp;
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">但现在有一个问题：虽然我们的进程是被放到后台了，在终端貌似看不到它的运行过程了。但是此进程还是与此终端相关联的，假如我们把终端关闭，那么这个进程也会结束。</p>
</div><div class="cl-preview-section"><h4 id="nohup-命令：使进程与终端分离" style="font-size: 26px;">nohup 命令：使进程与终端分离</h4>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">&amp; 符号虽然常用，但却有一个不可忽视的缺点：后台进程与终端相关联。一旦终端关闭或者用户登出，进程就自动结束。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">如果我们想让进程在以上情况下仍然继续在后台运行，那么我们须要用到 nohup 命令。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">当用户注销（logout）或者网络断开时，终端会收到 HUP（是 hangup 的缩写，英语“挂断”的意思）信号从而关闭其所有子进程；终端被关闭时也会关闭其子进程。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们可以用 nohup 命令使命令不受 HUP 信号影响。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们用 man 来看一下 nohup 命令的解释：</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d27ed1f0001bf2e21621358.png" alt="图片描述" data-original="http://img.mukewang.com/5d27ed1f0001bf2e21621358.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">可以看到，nohup 命令的简单描述如下：</p>
</div><div class="cl-preview-section"><pre><code>run a command immune to hangups, with output to a non-tty

</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">翻译出来大致就是：“使得运行的命令不受 hangup 信号影响，而且输出会存放到一个非 tty 中”。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">nohup 命令的用法很简单：在 nohup 命令之后接要运行的命令。例如，我们可以用 nohup 配合 cp 命令来实现文件的拷贝（这次拷贝的是 node.js 的源码。当然了，你可以用其他文件来测试）：</p>
</div><div class="cl-preview-section"><pre><code>nohup cp node-v10.15.3.tar.gz node-v10.15.3-copy.tar.gz

</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d27ed28000176bf20260282.png" alt="图片描述" data-original="http://img.mukewang.com/5d27ed28000176bf20260282.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">可以看到这次的输出信息是：“ignoring input and appending output to nohup.out”。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">大致意思是：“忽略输入，把输出追加到 nohup.out 文件中”。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">使用 nohup 命令后，输出会被默认地追加写入到一个叫 nohup.out 的文件里。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">现在，我们的进程已经不受终端关闭或者用户断开连接的影响了，会一直运行。当然了，用 kill 命令还是可以结束此进程的。要获知进程号，可以用我们之前学过的 ps 命令配合 grep 来查找。</p>
</div><div class="cl-preview-section"><pre><code>ps -ax | grep command

</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">上面命令里的 command 指代 nohup 后面跟着的命令。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">nohup 命令相当有用。想象以下场景：</p>
</div><div class="cl-preview-section"><blockquote>
<p style="font-size: 20px; line-height: 38px;">我登录远程服务器，然后运行了一个耗时命令，或者一个需要一直运行的命令，例如一个游戏的服务器程序。这时假如我掉线了，或者我不小心用 exit 命令退出了登录。那么这个耗时命令也会中止运行。那就很麻烦了。而且，如果这个程序本应该一直运行很久的，我也不可能一直保持登录状态等它结束啊。<br>
我家里还有老婆孩子呢，不能不去做饭啊，我要下班… 开个小玩笑。</p>
</blockquote>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">幸好，nohup 命令解决了这样的难题。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">一般我们也会把 nohup 和 &amp; 一起使用，例如：</p>
</div><div class="cl-preview-section"><pre><code>nohup cp node-v10.15.3.tar.gz node-v10.15.3-copy.tar.gz &amp;

</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d27ed36000150ca21460498.png" alt="图片描述" data-original="http://img.mukewang.com/5d27ed36000150ca21460498.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><pre><code>[1]+  Done    nohup cp node-v10.15.3.tar.gz node-v10.15.3-copy.tar.gz

</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这是在我按下了回车之后显示的。</p>
</div><div class="cl-preview-section"><h2 id="ctrl--z，jobs，bg-和-fg-命令：控制进程的前后台切换" style="font-size: 30px;">3. Ctrl + Z，jobs，bg 和 fg 命令：控制进程的前后台切换</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们来考虑一种情况：假如你要将进程转到后台运行，但是执行命令时忘记了在最后加上 &amp; 符号。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">如何再使此进程转为后台进程呢？有几种方法。我们一一来学习。</p>
</div><div class="cl-preview-section"><h4 id="ctrl--z：转到后台，并暂停运行" style="font-size: 26px;">Ctrl + Z：转到后台，并暂停运行</h4>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们用 top 命令来演示。运行：</p>
</div><div class="cl-preview-section"><pre><code>top

</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">因为 top 命令的作用是实时地显示各种系统信息和进程列表。这时，我们按下 Ctrl + Z 这个组合键：<br>
<img src="http://img.mukewang.com/5d27ed4500012b2721561360.png" alt="图片描述" data-original="http://img.mukewang.com/5d27ed4500012b2721561360.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">可以看到终端显示了：</p>
</div><div class="cl-preview-section"><pre><code>[1]+ Stopped top

</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这行信息。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">stopped 是英语“停止的”的意思，我们又看到 [1] 这个熟悉的信息，表示这是此终端第一个后台进程。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">所以表示 top 命令被放到了后台，此进程还是驻留在内存中，但是被暂停运行了。这个时候命令提示符又出现了，我们可以做其他事情了。</p>
</div><div class="cl-preview-section"><h4 id="bg-命令：使进程转到后台" style="font-size: 26px;">bg 命令：使进程转到后台</h4>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">经过上面的 Ctrl + Z 操作，我们可怜的 top 进程已经被“打入冷宫”（转入后台，并且被暂停运行了）。</p>
</div><div class="cl-preview-section"><blockquote>
<p style="font-size: 20px; line-height: 38px;">但是皇后不甘心啊：“臣妾虽然做不到，但即使在冷宫中，我也要工于心计、运筹帷幄，以期早日打败甄嬛。”</p>
</blockquote>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">那怎么办呢？可以运行 bg 命令。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">就是很简单地输入 bg，然后回车。bg 是英语 background 的缩写，表示“后台”。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">bg 命令的作用是将命令转入后台运行。假如命令已经在后台，并且暂停着，那么 bg 命令会将其状态改为运行。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">不加任何参数，bg 命令会默认作用于最近的一个后台进程，也就是刚才被 Ctrl + Z 暂停的 top 进程。如果后面加 %1，%2 这样的参数（不带 %，直接 1，2 这样也可以），则是作用于指定标号的进程。因为进程转入后台之后，会显示它在当前终端下的后台进程编号。例如目前 top 进程转入了后台，它的进程编号是 1（可以由 [1]+ 推断）。依次类推，bg %2 就是作用于编号为 2 的后台进程。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们输入 bg，然后回车。看到如下输出：</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d27ed540001589021581364.png" alt="图片描述" data-original="http://img.mukewang.com/5d27ed540001589021581364.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">上图中，终端显示了：</p>
</div><div class="cl-preview-section"><pre><code>[1]+ top &amp;

</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">表示 top 命令被转到了后台。因为 bg 命令会把在后台暂停的进程重新唤醒，使之在后台重新运行。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">不过，此时你的光标会跑到命令行提示符最前面。如果此时按下回车，会显示：</p>
</div><div class="cl-preview-section"><pre><code>[1]+  Stopped      top

</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d27ed5c0001d42221500516.png" alt="图片描述" data-original="http://img.mukewang.com/5d27ed5c0001d42221500516.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们用 ps 命令来查看一下进程信息：</p>
</div><div class="cl-preview-section"><pre><code>ps -aux

</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d27ed620001412c21561358.png" alt="图片描述" data-original="http://img.mukewang.com/5d27ed620001412c21561358.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">在上图中可以看到，top 这个进程的进程号（PID）是 1826，状态是 T。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">首先补充一些知识：</p>
</div><div class="cl-preview-section"><blockquote>
<p style="font-size: 20px; line-height: 38px;">Linux 中，进程有 5 种状态：</p>
<ol>
<li style="font-size: 20px; line-height: 38px;">运行 (正在运行或在运行队列中等待)</li>
<li style="font-size: 20px; line-height: 38px;">中断 (休眠中, 受阻, 在等待某个条件的形成或接受到信号)</li>
<li style="font-size: 20px; line-height: 38px;">不可中断 (收到信号不唤醒和不可运行, 进程必须等待直到有中断发生)</li>
<li style="font-size: 20px; line-height: 38px;">僵死 (进程已终止, 但进程描述符存在, 直到父进程使用 wait4() 系统调用后释放)</li>
<li style="font-size: 20px; line-height: 38px;">停止 (进程收到 SIGSTOP, SIGSTP, SIGTIN, SIGTOU 信号后停止运行)</li>
</ol>
</blockquote>
</div><div class="cl-preview-section"><blockquote>
<p style="font-size: 20px; line-height: 38px;">ps 命令标识进程的 5 种状态码如下：</p>
<ol>
<li style="font-size: 20px; line-height: 38px;">D 不可中断 uninterruptible sleep (usually IO)</li>
<li style="font-size: 20px; line-height: 38px;">R 运行 runnable (on run queue)</li>
<li style="font-size: 20px; line-height: 38px;">S 中断 sleeping</li>
<li style="font-size: 20px; line-height: 38px;">T 停止 traced or stopped</li>
<li style="font-size: 20px; line-height: 38px;">Z 僵死 a defunct (“zombie”) process</li>
</ol>
</blockquote>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">因此，我们的 top 进程的状态还是 T，也就是停止（stopped）的状态。很奇怪是吧?</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们用其他的命令来测试看看，我们测试 grep 命令。首先运行：</p>
</div><div class="cl-preview-section"><pre><code>grep -r "log" / &gt; grep_log 2&gt;&amp;1

</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">上面这个命令的作用是：在根目录 / 下查找包含 log 的行，将标准输出和标准错误输出都重定向到 grep_log 文件中。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">因此，虽然上述命令在运行，但终端中看不到任何信息。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们用 Ctrl + Z 来暂停此进程，并将其转到后台。然后再运行 bg 命令，使其重新在后台运行。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d27ed6c00013b4f19580456.png" alt="图片描述" data-original="http://img.mukewang.com/5d27ed6c00013b4f19580456.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">为什么 bg 作用于暂停的 grep 命令后，没有像刚才 top 命令一样仍然显示 Stopped 呢？</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们再用 ps -aux 看一下：<br>
<img src="http://img.mukewang.com/5d27ed720001ccd021641362.png" alt="图片描述" data-original="http://img.mukewang.com/5d27ed720001ccd021641362.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">可以看到，top 命令的状态是 T，也就是停止（Stopped）。而 grep 命令的状态则是 D，也就是不可中断的睡眠（但其实是在运行，等会我们就会看到）。</p>
</div><div class="cl-preview-section"><blockquote>
<p style="font-size: 20px; line-height: 38px;">疑问：我也不太清楚为什么对普通的命令（例如 grep），bg 命令是起作用的，会将其转成后台运行。<br>
但是对于 top 命令，bg 为什么不能将其转成后台运行，可能是因为 top 命令本身比较特殊吧。<br>
也许是因为 top 命令是前台交互式命令，因此不能被置于后台运行。如有知道的，欢迎留言，我可以修改。谢谢</p>
</blockquote>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">小结一下：</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">如果你原本想要使一个命令运行在后台，成为后台进程，但是忘记加 &amp; 符号了。那么可以按下面的顺序使此进程转为后台运行：</p>
</div><div class="cl-preview-section"><ul>
<li style="font-size: 20px; line-height: 38px;">Ctrl + Z：使进程转为后台暂停。</li>
<li style="font-size: 20px; line-height: 38px;">bg：使进程转为后台运行。</li>
</ul>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">那你也许要问：为什么不直接用 bg 命令一步到位呢？</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">因为，如果不先用 Ctrl + Z 将此进程暂停，此进程就一直在前台运行，你没法在命令提示符后面输入啊。</p>
</div><div class="cl-preview-section"><h4 id="jobs-命令：显示后台进程状态" style="font-size: 26px;">jobs 命令：显示后台进程状态</h4>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这个命令很强大，毕竟和乔布斯乔老爷子（乔布斯的英文就是 jobs，全名是 Steve Jobs。job 是英语“工作”的意思，jobs 是复数形式）一样名字么。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">jobs 命令的作用是显示当前终端里的后台进程状态。虽然我们可以用 ps 命令来查看进程状态，但是 ps 命令输出的进程列表太长了。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">聪明如你一定想到了，我们可以用 jobs 命令来显示刚才那两个进程的状态：top 进程和 grep 进程。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d27ed7f0001910320100342.png" alt="图片描述" data-original="http://img.mukewang.com/5d27ed7f0001910320100342.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">jobs 命令的输出共分三列，我们逐列来说明：</p>
</div><div class="cl-preview-section"><ol>
<li style="font-size: 20px; line-height: 38px;">显示后台进程标号：比如上例中 top 进程的标号是 1，grep 进程的标号是 2，如果还有其他后台进程，那么就会有 [3]，[4]等等。这个标号和 PID（进程号）是不一样的。这个标号只是显示当前终端下的后台进程的一个编号；</li>
<li style="font-size: 20px; line-height: 38px;">显示后台进程状态：比如 Stopped 是“停止的”的意思，Running 是“运行的”的意思。还有其他状态；</li>
<li style="font-size: 20px; line-height: 38px;">命令本身。</li>
</ol>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">可以看到，我们的 top 进程确实是在后台暂停了，因为显示 Stopped。grep 进程在后台运行，因为显示 Running。</p>
</div><div class="cl-preview-section"><h4 id="fg-命令：使进程转到前台" style="font-size: 26px;">fg 命令：使进程转到前台</h4>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">fg 是英语 foreground 的意思，表示“前台”。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">与 bg 命令相反，fg 命令的作用是：使进程转为前台运行。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">用法也很简单，和 bg 一样，如果不加参数，那么 fg 命令作用于最近的一个后台进程；如果加参数，如 %2，那么表示作用于本终端中第二个后台进程。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">如果我们现在运行 fg 命令，就会把 top 命令转到前台运行。</p>
</div><div class="cl-preview-section"><pre><code>fg

</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d27ed8c0001546e21601360.png" alt="图片描述" data-original="http://img.mukewang.com/5d27ed8c0001546e21601360.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">上图中，top 进程被 fg 命令从后台 Stopped 的状态转到了前台运行。接着，我用 Ctrl + C 终止了 top 进程的运行。再次运行 jobs 命令，可以看到这会只有 grep 进程还在后台运行了，因为 top 进程已经被销毁了。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">好了，讲了这么多知识点，是不是有点晕呢？没关系。我们用下面这个状态图来做个总结，应该就很清楚了：</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d27ed94000124f610581196.png" alt="图片描述" data-original="http://img.mukewang.com/5d27ed94000124f610581196.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">解释一下上图：</p>
</div><div class="cl-preview-section"><ol>
<li style="font-size: 20px; line-height: 38px;">如果我们运行一个程序，默认情况下，它会成为一个前台运行的进程。我们可以按组合键 Ctrl + C 来销毁此进程。</li>
<li style="font-size: 20px; line-height: 38px;">我们也可以使此进程在后台运行。假如运行程序时就用 &amp; 放在命令最后，那么进程就会在后台运行。</li>
<li style="font-size: 20px; line-height: 38px;">假如在进程运行起来后，按 Ctrl + Z，则进程会转到后台，并且停止。此时如果运行 bg 命令，则进程重新运行，并继续在后台。</li>
<li style="font-size: 20px; line-height: 38px;">fg 命令可以使进程转到前台，并且运行。</li>
</ol>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">花点时间好好理解一下这个状态图。这个图很重要，几乎概括了后台前台进程切换的所有情况。</p>
</div><div class="cl-preview-section"><div class="summary"><h5 class="centertitle" style="font-size: 20px; line-height: 38px;">小结 </h5></div><!--title:&#23567;&#32467; -->
</div><div class="cl-preview-section"><ol>
<li style="font-size: 20px; line-height: 38px;">我们可以使程序在后台运行，成为后台进程。这样在当前终端中我们就可以做其他事了，而不必等待此进程运行结束。</li>
<li style="font-size: 20px; line-height: 38px;">为了使一个程序在后台运行，可以在命令的最后加上 &amp; 这个符号。但是，如果你关闭终端或退出登录，此后台进程还是会结束。为了将后台进程与本终端分离，可以使用 nohup 命令，使得进程不再受终端关闭或用户登出的影响。</li>
<li style="font-size: 20px; line-height: 38px;">如果你运行了一个前台进程，但是想要将其转为后台运行进程。你可以先用 Ctrl + Z 组合键将其转为后台暂停，然后运行 bg 命令使其在后台重新运行。如果你要将一个后台命令（不管它是后台运行还是后台暂停）重新转为前台运行，只要用 fg 命令就可以了。</li>
</ol>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">今天的课就到这里，一起加油吧！</p>
</div></div>
            </div>
                            <!-- 买过的阅读 -->
                <div class="art-next-prev clearfix">
                                                                        <!-- 已买且开放 或者可以试读 -->
                            <a href="/read/39/article/520">
                                                    <div class="prev l clearfix">
                                <div class="icon l">
                                    <i class="imv2-arrow3_l"></i>
                                </div>
                                <p>
                                    26 进程操作和系统重启
                                </p>
                            </div>
                        </a>
                                                                                            <!-- 已买且开放 或者可以试读 -->
                            <a href="/read/39/article/522">
                                                    <div class="next r clearfix">
                                <p>
                                    28 多个终端和Terminator软件
                                </p>
                                <div class="icon r">
                                    <i class="imv2-arrow3_r"></i>
                                </div>

                            </div>
                        </a>
                                    </div>
                    </div>
        <div class="comments-con js-comments-con" id="coments_con">     <div class="number">精选留言 <span class="js-number">1</span></div>     <div class="comments">         <div class="input-fake js-showcommentModal">             欢迎在这里发表留言，作者筛选后可公开显示         </div>                      <ul class="comments-list js-comments-list">                                                        <li class="comment clearfix">                                          <a href="//www.imooc.com/u/5714088/articles" target="_blank">                             <div class="head-img l" style="background-image:url(//img1.mukewang.com/59953b9e000143c701000100-100-100.jpg)"></div>                         </a>                         <div class="comment-detail l">                             <div class="hoverDisplay">                                 <div class="com-author clearfix">                                                                                                               <a href="//www.imooc.com/u/5714088/articles" target="_blank">                                         <div class="name l">向往那片天空</div>                                     </a>                                                                                                                                                                                              </div>                                 <div class="com-content">                                     学习了                                 </div>                                 <div class="com-other clearfix">                                                                              <!-- 没点过赞 -->                                         <div class="btn-agree js-agree l" data-commentid="1009">                                                                                  <i class="imv2-thumb_up"></i>                                             <span>0</span>                                         </div>                                                                                                               <div class="btn-reply l js-reply" data-replyid="1009">回复</div>                                     <!-- 没登录不显示举报 -->                                                                              <div class="btn-report l js-tip-off comment-report" data-id="1009" data-uid="5714088" data-src="/read/39/article/521" data-type="15">举报</div>                                                                          <div class="time r">2天前</div>                                 </div>                             </div>                                                                                   </div>                     </li>                              </ul>                           </div>  </div>



    </div>
    
    
    

</div>
 
<!-- 专栏介绍页专栏评价 -->

<!-- 专栏介绍页底部三条评价 -->

<!-- 专栏阅读页弹层目录和介绍页页面目录 -->

<!-- 专栏阅读页发布回复 -->

<!-- 专栏阅读页发布评论 -->

<!-- 专栏阅读页底部评论 -->

<!-- 专栏阅读 单个 评论 -->

<!-- 新增回复和展开三条以外回复 -->

<!-- 立即订阅的弹窗 -->












</div></body></html>