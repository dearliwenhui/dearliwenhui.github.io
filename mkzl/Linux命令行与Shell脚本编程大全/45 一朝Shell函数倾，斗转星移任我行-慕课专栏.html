<html><head><meta charset="utf-8"><title>45 一朝Shell函数倾，斗转星移任我行-慕课专栏</title>
			<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
			<meta name="renderer" content="webkit">
			<meta property="qc:admins" content="77103107776157736375">
			<meta property="wb:webmaster" content="c4f857219bfae3cb">
			<meta http-equiv="Access-Control-Allow-Origin" content="*">
			<meta http-equiv="Cache-Control" content="no-transform ">
			<meta http-equiv="Cache-Control" content="no-siteapp">
			<link rel="apple-touch-icon" sizes="76x76" href="https://www.imooc.com/static/img/common/touch-icon-ipad.png">
			<link rel="apple-touch-icon" sizes="120x120" href="https://www.imooc.com/static/img/common/touch-icon-iphone-retina.png">
			<link rel="apple-touch-icon" sizes="152x152" href="https://www.imooc.com/static/img/common/touch-icon-ipad-retina.png">
			<link href="https://moco.imooc.com/captcha/style/captcha.min.css" rel="stylesheet">
			<link rel="stylesheet" href="https://www.imooc.com/static/moco/v1.0/dist/css/moco.min.css?t=201907021539" type="text/css">
			<link rel="stylesheet" href="https://www.imooc.com/static/lib/swiper/swiper-3.4.2.min.css?t=201907021539">
			<link rel="stylesheet" href="https://static.mukewang.com/static/css/??base.css,common/common-less.css?t=2.5,column/zhuanlanChapter-less.css?t=2.5,course/inc/course_tipoff-less.css?t=2.5?v=201907051055" type="text/css">
			<link charset="utf-8" rel="stylesheet" href="https://www.imooc.com/static/lib/ueditor/themes/imooc/css/ueditor.css?v=201907021539"><link rel="stylesheet" href="https://www.imooc.com/static/lib/baiduShare/api/css/share_style0_16.css?v=6aba13f0.css"></head>
			<body><div id="main">


<div class="main-con hide-menu">
    <!-- 左侧菜单 & 索引 -->
    
    <div class="right-content" style="padding-left: 0px;">
        <div class="container clearfix" id="top" style="width: 1134px; display: block;">
            
            
            <div class="center_con js-center_con l" style="width: 1134px;">
                <div class="article-con">
                                            <!-- 买过的阅读 -->
                        

                    
                    <div class="art-title" style="margin-top: 0px;">
                        45 一朝Shell函数倾，斗转星移任我行
                    </div>
                    <div class="art-info clearfix">
                        
                        <span class="l">
                            更新时间：2019-08-14 10:06:27
                        </span>
                    </div>
                    <div class="art-top">
                                                <img src="https://img1.mukewang.com/5d4d069f0001712c06400359.jpg" alt="">
                                                                        <div class="famous-word-box">
                            <img src="https://www.imooc.com/static/img/column/bg-l.png" alt="" class="bg1 bg">
                            <img src="https://www.imooc.com/static/img/column/bg-r.png" alt="" class="bg2 bg">
                            <div class="famous-word">书是人类进步的阶梯。<p class="author">——高尔基</p></div>
                        </div>
                                            </div>
                    <div class="art-content js-lookimg">
                        <div id="article_content">
                            <div class="cl-preview-section"><h3 id="内容简介">内容简介</h3>
</div><div class="cl-preview-section"><ol>
<li style="font-size: 20px; line-height: 38px;">前言</li>
<li style="font-size: 20px; line-height: 38px;">函数的作用</li>
<li style="font-size: 20px; line-height: 38px;">函数的定义</li>
<li style="font-size: 20px; line-height: 38px;">传递参数</li>
<li style="font-size: 20px; line-height: 38px;">返回值</li>
<li style="font-size: 20px; line-height: 38px;">变量作用范围</li>
<li style="font-size: 20px; line-height: 38px;">重载命令</li>
<li style="font-size: 20px; line-height: 38px;">函数的设计</li>
<li style="font-size: 20px; line-height: 38px;">总结</li>
</ol>
</div><div class="cl-preview-section"><h3 id="前言">1. 前言</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">上一课 <a href="">带你玩转Linux和Shell编程 | 第五部分第六课：循环往复，Shell开路</a> 中，我们学习了 Shell 的循环语句。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这一课我们来学习对于大多数编程语言来说很重要的内容：<strong>函数</strong>。</p>
</div><div class="cl-preview-section"><h3 id="函数的作用">2. 函数的作用</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">函数到底是什么呢？</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">以前在学校里学习数学的时候，也学过函数。例如：</p>
</div><div class="cl-preview-section"><pre><code>y = 2x + 1
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这个公式也被称为一个函数，对于每一个给定的 x 值，都会有一个 y 值被计算出来，就是 2 倍的 x ，加上 1。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">编程的基础是数学，因此程序中的函数也有点数学中函数的味道：给它一定输入，它会为你产出一定的东西。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">函数在英语中是 function，表示“功能，作用”的意思。因此，你可以这么理解：“函数是实现一定功能的代码块”。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们可以把函数比作一个香肠制造机，在输入那一头你把猪装进去，输出那一头就出来香肠了。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img class="" src="https://img.mukewang.com/5d4812280001656507200361.png" data-original="//img.mukewang.com/5d4812280001656507200361.png" alt="图片描述"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">函数还是重用代码（reuse code）的很好方式。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">为什么这么说呢？</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">因为到目前为止，我们写的所有 Shell 文件，都是定义一些变量，然后执行一些命令，这些命令还都是逐行依次执行。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">目前我们写的例子程序都比较短小，因此看不出有什么问题。假如这个文件的内容一多，达到好几万行甚至更多，而且有不少重复的内容，那么要维护这样一个庞杂的文件就极为困难。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这时候，函数就可以出马帮我们解围。因为函数可以把一块代码包裹起来，使之成为一个整体，完成某些任务。而且，我们在程序的其它地方，还可以多次使用这块代码。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这样，我们的程序就会变得有条理，也没有那么多重复的相似代码。你可以把函数想象成 Shell 脚本里的小脚本。</p>
</div><div class="cl-preview-section"><h3 id="函数的定义">3. 函数的定义</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">说了这么多，也许还是不太好理解，我们不如实际来使用一下函数。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">如果你学过其它编程语言，比如 C 语言，Java，C++等等，那么其实 Shell 中的函数机理是与之类似的。但是，Shell 比较“任性”，它的函数形式和主流编程语言有不少区别。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">定义（或创建） Shell 函数是非常容易的。有两种方式：</p>
</div><div class="cl-preview-section"><pre><code>函数名 () {
    函数体
}
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">或：</p>
</div><div class="cl-preview-section"><pre><code>function 函数名 {
    函数体
}
</code></pre>
</div><div class="cl-preview-section"><ul>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">这两种方式都是可行的。看你个人喜好用哪一种方式。我个人喜欢第一种方式，因为 () 比 function 少好多个字符。要知道，程序员是要懂得偷懒的，少输入一点就节省时间。</p>
</li>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">函数名后面跟着的圆括号里不加任何参数：这一点与主流编程语言很不相同。C 语言，Java，C++ 等语言中，函数的圆括号中是可以放置参数的（也就是函数的一部分输入），但是 <strong>Shell 中的函数的圆括号里不能放置参数</strong>。</p>
</li>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">函数的完整定义必须置于函数的调用之前。</p>
</li>
</ul>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们通过一个小例子来加深理解：</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">首先，用 Vim 或其他文本编辑器来创建一个文件，叫作 function.sh：</p>
</div><div class="cl-preview-section"><pre><code>vim function.sh
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">然后在里面输入以下内容：</p>
</div><div class="cl-preview-section"><pre><code>#!/bin/bash

print_something () {
    echo "Hello, I am a function"
}

print_something
print_something
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">“Hello, I am a function” 是英语“你好，我是一个函数”的意思。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">运行：</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img class="" src="https://img.mukewang.com/5d48123200015e6411240410.png" data-original="//img.mukewang.com/5d48123200015e6411240410.png" alt="图片描述"><br>
可以看到程序打印了两次 “Hello, I am a function”。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们逐行来解释这个程序：</p>
</div><div class="cl-preview-section"><ul>
<li style="font-size: 20px; line-height: 38px;">第 3 行 ： 我们开始了一个函数的定义，给它起了一个名字，叫做 print_something（print 是英语“打印”的意思，something 是英语“某些东西”的意思）。</li>
<li style="font-size: 20px; line-height: 38px;">第 4 行：在大括号 <code>{}</code> 中，我们可以写入多个命令。</li>
<li style="font-size: 20px; line-height: 38px;">第 7 和 8 行：在函数定义之后，我们就可以调用它任意多次。这里连续调用了两次。</li>
</ul>
</div><div class="cl-preview-section"><h3 id="传递参数">4. 传递参数</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们上面的函数并没有处理参数，有时候我们希望函数能为我们处理一些参数，然后输出一些结果。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">在 Shell 函数中，我们给它传递参数的方式其实很像给 Shell 脚本传递命令行参数。我们把参数直接置于函数名字后面，然后就像我们之前 Shell 脚本的参数那样：<code>$1</code>，<code>$2</code>，<code>$3</code>等等。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们来看一个例子：</p>
</div><div class="cl-preview-section"><pre><code>#!/bin/bash

print_something () {
    echo Hello $1
}

print_something Matthew
print_something Mark
print_something Luke
print_something John
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img class="" src="https://img.mukewang.com/5d48123900014e6d09400444.png" data-original="//img.mukewang.com/5d48123900014e6d09400444.png" alt="图片描述"></p>
</div><div class="cl-preview-section"><h3 id="返回值">5. 返回值</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">大多数主流编程语言都有函数返回值的概念，可以让函数回传一些数据。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">Shell 的函数却没办法做到。但是 Shell 的函数可以返回一个状态，有点类似一个程序或命令退出时会有一个退出状态，表明是否成功。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">Shell 函数要返回状态，也用 return 这个关键字（ return 是英语“返回”的意思）。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">来看一个例子：</p>
</div><div class="cl-preview-section"><pre><code>#!/bin/bash

print_something () {
    echo Hello $1
    return 1
}

print_something Luke
print_something John
echo Return value of previous function is $?
</code></pre>
</div><div class="cl-preview-section"><ul>
<li style="font-size: 20px; line-height: 38px;">第 5 行：返回的状态不一定要是被硬编码的（比如上例中的 1 ），也可以是一个变量。</li>
<li style="font-size: 20px; line-height: 38px;">第 10 行：变量 <code>$?</code> 包含前一次被运行的命令或函数的返回状态。</li>
</ul>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">运行：</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img class="" src="https://img.mukewang.com/5d481240000153aa10320390.png" data-original="//img.mukewang.com/5d481240000153aa10320390.png" alt="图片描述"><br>
“Return value of previous function is” 表示“上一个函数的返回值是”。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">一般来说，返回状态 0 表示一切顺利；一个非零值表示有错误。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">如果你实在想要函数返回一个数值（比如说一个计算的值），那么你也可以用命令的执行结果。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">如下：</p>
</div><div class="cl-preview-section"><pre><code>#!/bin/bash

lines_in_file () {
    cat $1 | wc -l
}

line_num=$(lines_in_file $1)

echo The file $1 has $line_num lines
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">运行：</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img class="" src="https://img.mukewang.com/5d4812470001e09519501038.png" data-original="//img.mukewang.com/5d4812470001e09519501038.png" alt="图片描述"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">上面的脚本就是输出参数 1 所代表的文件的行数。因为 myFile 这个文件有 13 行。所以输出：“The file myFile has 13 lines”，表示“myFile 这个文件有 13 行”。</p>
</div><div class="cl-preview-section"><h3 id="变量作用范围">6. 变量作用范围</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">变量的作用范围意味着一个 Shell 脚本的哪些部分可以访问到这个变量。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">默认来说，一个变量是“全局的”（global），意味着在脚本的任何地方都可以访问它。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们也可以创建局部（local）变量。当我们在函数中创建局部变量时，这个变量就只能在这个函数中被访问。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">要定义一个局部变量，我们只要在第一次给这个变量赋值时在变量名前加上关键字 local 即可（ local 是英语“本地的”的意思）。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">定义局部变量有一个好处，就是可以防止被脚本的其它地方的代码意外改变数值。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">来看一个例子：</p>
</div><div class="cl-preview-section"><pre><code>#!/bin/bash

local_global () {
    local var1='local 1'
    echo Inside function: var1 is $var1 : var2 is $var2
    var1='changed again'   # 这里的 var1 是函数中定义的局部变量
    var2='2 changed again' # 这里的 var2 是函数外定义的全局变量
}

var1='global 1'
var2='global 2'

echo Before function call: var1 is $var1 : var2 is $var2

local_global

echo After function call: var1 is $var1 : var2 is $var2
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">运行：</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img class="" src="https://img.mukewang.com/5d48124e0001116416760400.png" data-original="//img.mukewang.com/5d48124e0001116416760400.png" alt="图片描述"></p>
</div><div class="cl-preview-section"><ul>
<li style="font-size: 20px; line-height: 38px;">“Before function call” 表示“在函数调用前”。</li>
<li style="font-size: 20px; line-height: 38px;">“Inside function” 表示“在函数中”。</li>
<li style="font-size: 20px; line-height: 38px;">“After function call” 表示“在函数调用后”。</li>
</ul>
</div><div class="cl-preview-section"><blockquote>
<p style="font-size: 20px; line-height: 38px;">在函数中，尽量用局部变量。只有实在不行才用全局变量，毕竟全局变量不太安全。</p>
</blockquote>
</div><div class="cl-preview-section"><h3 id="重载命令">7. 重载命令</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们可以用函数来实现命令的重载，也就是说把函数的名字取成与我们通常在命令行用的命令相同的名字。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">例如，也许我们每次在脚本中调用 ls 命令时，其实是想要实现 <code>ls -lh</code> 的效果。那么我们可以这么做：</p>
</div><div class="cl-preview-section"><pre><code>#!/bin/bash

ls () {
    command ls -lh
}

ls
</code></pre>
</div><div class="cl-preview-section"><blockquote>
<p style="font-size: 20px; line-height: 38px;">第 4 行如果没有 command 这个关键字（command 是英语“命令”的意思），那么程序会陷入无限循环。<br>
如果你不小心忘了 command 关键字而陷入无限循环，可以用 Ctrl + c 的组合快捷键来停止程序。</p>
</blockquote>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">运行：</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img class="" src="https://img.mukewang.com/5d4812540001f0de19461404.png" data-original="//img.mukewang.com/5d4812540001f0de19461404.png" alt="图片描述"></p>
</div><div class="cl-preview-section"><h3 id="函数的设计">8. 函数的设计</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们已经看到：在 Shell 中定义函数是很简单的。但是要定义容易维护和易于扩展的函数却需要经验和时间。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">有时候，好的设计意味着更少的代码；有时候意味着需求变更时最少的改动；有时候意味着不容易引起错误。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">如果一个任务需要被执行多次，那么把它放到一个函数里是不错的选择。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">设计模式（Design Pattern）中有一个原则是“单一职责原则”（Single Responsibility Principle）。这种原则也适用于函数的设计，尽量不要让一个函数执行很多任务。</p>
</div><div class="cl-preview-section"><h3 id="总结">9. 总结</h3>
</div><div class="cl-preview-section"><ol>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">函数使我们可以轻松地重用代码，使程序更有条理，更易理解和扩展；</p>
</li>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">我们有两种定义函数的方式：<code>function 函数名</code> 或 <code>函数名 ()</code>；</p>
</li>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">关键字 return 可以用于返回状态值；</p>
</li>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">关键字 local 可以用于定义局部变量；</p>
</li>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">关键字 command 使得函数可以重载命令。</p>
</li>
</ol>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">今天的课就到这里，一起加油吧！</p>
</div>}
                        </div>
                    </div>
                                            <!-- 买过的阅读 -->
                        <div class="art-next-prev clearfix">
                                                                                                <!-- 已买且开放 或者可以试读 -->
                                    <a href="/read/39/article/538">
                                                                    <div class="prev l clearfix">
                                        <div class="icon l">
                                            <i class="imv2-arrow3_l"></i>
                                        </div>
                                        <p>
                                            44 循环往复，Shell开路
                                        </p>
                                    </div>
                                </a>
                                                                                                                            <!-- 已买且开放 或者可以试读 -->
                                    <a href="/read/39/article/540">
                                                                    <div class="next r clearfix">
                                        <p>
                                            46 Shell实现图片展示网页
                                        </p>
                                        <div class="icon r">
                                            <i class="imv2-arrow3_r"></i>
                                        </div>

                                    </div>
                                </a>
                                                    </div>
                                    </div>
                <div class="comments-con js-comments-con" id="coments_con">
                </div>

                
            </div>
            
            
            

        </div>
    </div>
</div>

<div class="modal modal-jiaQun-new hide" id="modal-jiaQun">
    <div class="inner" style="">
        <div class="modal-close js-close-jiaQun">
            <i class="imv2-close"></i>
        </div>
        <div class="content">
            <img src="https://img4.mukewang.com/5d5a70bc000165cb05400598.jpg">
            <div class="right-info">
                <div class="title">
                    扫码加入慕课前沿技术核心用户群
                </div>
                <div class="desc">
                                            <p class="mb6">验证信息：<span id="joincode">1907221925272456</span><span class="copy js-copy-joincode">复制</span></p>
                                        <p class="mb6">QQ讨论群号：812552418</p>
                                            <p>QQ群URL：<a href="https://jq.qq.com/?_wv=1027&amp;k=50iMJcL" target="_blank">点击访问</a></p>
                                    </div>
            </div>
            <p class="tip">若遇到搜索不到QQ群或加群失败，请联系客服邮箱:kf@imooc.com</p>
        </div>
    </div>
</div>
 
<!-- 专栏介绍页专栏评价 -->

<!-- 专栏介绍页底部三条评价 -->

<!-- 专栏阅读页弹层目录和介绍页页面目录 -->

<!-- 专栏阅读页发布回复 -->

<!-- 专栏阅读页发布评论 -->

<!-- 专栏阅读页底部评论 -->

<!-- 专栏阅读 单个 评论 -->

<!-- 新增回复和展开三条以外回复 -->

<!-- 立即订阅的弹窗 -->












</div></body></html>