<html><head><meta charset="utf-8"><title>34 让用户买买买：开发实现商城购物车页面-慕课专栏</title>
			<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
			<meta name="renderer" content="webkit">
			<meta property="qc:admins" content="77103107776157736375">
			<meta property="wb:webmaster" content="c4f857219bfae3cb">
			<meta http-equiv="Access-Control-Allow-Origin" content="*">
			<meta http-equiv="Cache-Control" content="no-transform ">
			<meta http-equiv="Cache-Control" content="no-siteapp">
			<link rel="apple-touch-icon" sizes="76x76" href="https://www.imooc.com/static/img/common/touch-icon-ipad.png">
			<link rel="apple-touch-icon" sizes="120x120" href="https://www.imooc.com/static/img/common/touch-icon-iphone-retina.png">
			<link rel="apple-touch-icon" sizes="152x152" href="https://www.imooc.com/static/img/common/touch-icon-ipad-retina.png">
			<link href="https://moco.imooc.com/captcha/style/captcha.min.css" rel="stylesheet">
			<link rel="stylesheet" href="https://www.imooc.com/static/moco/v1.0/dist/css/moco.min.css?t=201907021539" type="text/css">
			<link rel="stylesheet" href="https://www.imooc.com/static/lib/swiper/swiper-3.4.2.min.css?t=201907021539">
			<link rel="stylesheet" href="../zhuanlanChapter-less.css?v=201907051055" type="text/css">
			<link charset="utf-8" rel="stylesheet" href="https://www.imooc.com/static/lib/ueditor/themes/imooc/css/ueditor.css?v=201907021539"><link rel="stylesheet" href="https://www.imooc.com/static/lib/baiduShare/api/css/share_style0_16.css?v=6aba13f0.css"></head>
			<body><div id="main">


<div class="main-con hide-menu">
    <!-- 左侧菜单 & 索引 -->
    
    <div class="right-content" style="padding-left: 0px;">
        <div class="container clearfix" id="top" style="width: 1134px; display: block;">
            
            
            <div class="center_con js-center_con l" style="width: 1134px;">
                <div class="article-con">
                                            <!-- 买过的阅读 -->
                        

                    
                    <div class="art-title" style="margin-top: 0px;">
                        34 让用户买买买：开发实现商城购物车页面
                    </div>
                    <div class="art-info clearfix">
                        
                        <span class="l">
                            更新时间：2019-09-06 13:32:29
                        </span>
                    </div>
                    <div class="art-top">
                                                <img src="https://img1.mukewang.com/5d6b65f8000160b306400359.jpg" alt="">
                                                                        <div class="famous-word-box">
                            <img src="https://www.imooc.com/static/img/column/bg-l.png" alt="" class="bg1 bg">
                            <img src="https://www.imooc.com/static/img/column/bg-r.png" alt="" class="bg2 bg">
                            <div class="famous-word">什么是路？就是从没路的地方践踏出来的，从只有荆棘的地方开辟出来的。 <p class="author">—— 鲁迅</p></div>
                        </div>
                                            </div>
                    <div class="art-content js-lookimg">
                        <div id="article_content">
                            <div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">上一节我们在商品详情页面实现了单个商品的支付功能，本节将实现在购物车页面同时购买多个商品。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">在第二节中，我们已经设计了购物车页面效果，如图 16 所示。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>图 16 购物车页面</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img class="" src="https://img.mukewang.com/5d6b5f6100018cd409001600.jpg" data-original="//img.mukewang.com/5d6b5f6100018cd409001600.jpg" alt="图片描述"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">以业务设计、功能设计和页面效果图为基础，按照 “分类拆解法” 的步骤即可实现购物车页面。</p>
</div><div class="cl-preview-section"><h2 id="拆解步骤" style="font-size: 30px;">1. 拆解步骤</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>在本节仅给出拆解结果，拆解过程请回顾第二章第三节对 “分类拆解法” 的详细讲解内容。</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>请各位同学自己动手实践，按照拆解步骤拆解，结合第一节的业务设计、第二节的功能设计，拆解本节图 16 的购物车页面，然后将自己的拆解结果与本节列出的拆解结果进行对照总结。这是本节内容的实践环节之一。</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">购物车页面可以由上到下拆解为 2 个子部件，具体拆解结果如下：</p>
</div><div class="cl-preview-section"><ul>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">子部件 1 ：购物车清单栏</p>
<p style="font-size: 20px; line-height: 38px;">子部件 1 的显示元素包括：</p>
<ul>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">标题</p>
<p style="font-size: 20px; line-height: 38px;">静态界面，无事件，无数据</p>
</li>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">清空按钮</p>
<p style="font-size: 20px; line-height: 38px;">单条内容交互界面，事件为用户点击事件，数据为微信客户端的购物车数据缓存</p>
<p style="font-size: 20px; line-height: 38px;">用户点击时间事件的事件响应为：清空购物车数据缓存中的所有商品</p>
</li>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">购物车商品列表</p>
<p style="font-size: 20px; line-height: 38px;">多条内容交互界面，事件为用户点击事件，数据为微信客户端的购物车数据缓存</p>
<p style="font-size: 20px; line-height: 38px;">在页面加载时，从购物车数据缓存中读取购物车中的商品列表，并显示到页面中</p>
<p style="font-size: 20px; line-height: 38px;">商品列表中的每个商品分左中右三栏水平显示，左侧显示商品缩略图，中间显示商品名称、商品价格，右侧显示删除图标</p>
<p style="font-size: 20px; line-height: 38px;">用户点击商品列表左侧元素、中间元素的事件响应为：页面跳转到商品详情页面，需要向商品详情页面传递商品 ID</p>
<p style="font-size: 20px; line-height: 38px;">用户点击商品列表右侧删除图标的事件响应为：从微信客户端的购物车缓存中去除该商品，并刷新显示购物车商品列表</p>
<p style="font-size: 20px; line-height: 38px;"><strong>商品价格需要根据用户是否付费会员、用户等级是否有购物折扣等条件显示不同内容，具体描述与本章第六节 “子部件 2 ：商品价格栏” 相同，请参考上一节的内容。</strong></p>
</li>
</ul>
</li>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">子部件 2 ：底部操作栏</p>
<p style="font-size: 20px; line-height: 38px;">底部操作栏固定在页面底部显示，不随屏幕滑动变化</p>
<p style="font-size: 20px; line-height: 38px;">当购物车缓存中没有商品数据时，应该隐藏底部操作栏（购物车中没有商品时，无法进行购买）</p>
<p style="font-size: 20px; line-height: 38px;">子部件 2 的显示元素包括：</p>
<ul>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">原价合计</p>
<p style="font-size: 20px; line-height: 38px;">单条内容交互界面，无事件，数据为购物车商品列表中所有商品的原价合计</p>
</li>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">折扣合计</p>
<p style="font-size: 20px; line-height: 38px;">单条内容交互界面，无事件，数据为原价合计 -  实际支付价格合计</p>
</li>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">实际支付价格合计</p>
<p style="font-size: 20px; line-height: 38px;">单条内容交互界面，无事件，数据为购物车商品列表中所有商品的原价合计 * 用户享受的折扣率</p>
</li>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">结算按钮</p>
<p style="font-size: 20px; line-height: 38px;">静态界面，事件为用户点击事件，无数据</p>
<p style="font-size: 20px; line-height: 38px;">用户点击事件的事件响应为：将购物车中所有商品的商品 ID 数组传递给支付云函数，云函数执行完支付逻辑后返回支付结果，在页面中显示云函数返回的支付结果</p>
</li>
</ul>
</li>
</ul>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">除上述 2 个子部件外，还需要两个子部件用于显示支付结果：</p>
</div><div class="cl-preview-section"><ul>
<li style="font-size: 20px; line-height: 38px;">子部件 3 ：显示支付成功结果</li>
<li style="font-size: 20px; line-height: 38px;">子部件 4 ：显示支付失败结果</li>
</ul>
</div><div class="cl-preview-section"><h2 id="编程步骤" style="font-size: 30px;">2. 编程步骤</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">与上一节类似，购物车页面需要使用数据服务 <code>UserService</code> ， <code>LevelService</code> 读取用户信息、计算用户等级，判断用户是否付费会员。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">在专栏的源代码中，购物车数据缓存包含了完整的商品信息，商品图片、商品原价等信息可直接从缓存中得到。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>在实际的商城业务中商品信息会发生变化，如商品的价格变动、商品下架等情况时有发生。因此，在使用专栏源代码进行实际商业应用开发时，请仅保存商品 ID 到购物车数据缓存中，在购物车页面中调用数据服务 <code>ProductService</code> 来获取商品信息。</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">学有余力的同学在实现购物车页面时，可以只保存商品 ID 到购物车数据缓存，商品信息从数据库中读取。</p>
</div><div class="cl-preview-section"><h3 id="定义页面子部件及其排列顺序">2.1 定义页面子部件及其排列顺序</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">与上一节类似，我们需要首先理清数据读取的顺序与读取内容。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">数据内容包括：</p>
</div><div class="cl-preview-section"><pre class="  language-js"><code class="prism  language-js">  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    myInfo<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//用户信息，在支付时需要根据当前可用积分判断用户是否有足够积分购买商品</span>
    totalPrice<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//购物车中的商品原价合计</span>
    totalDiscountedPrice<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//购物车中的商品用户实际支付价格合计</span>
    discount<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//用户会员等级或小M卡会员对应的折扣率</span>
    isMembershipExpired<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//用户是否是小M卡会员（还在会员有效期中）</span>
    showPaySuccess<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否显示支付成功结果</span>
    showPayFaild<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否显示支付失败结果</span>
    cart<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//购物车数据</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">数据读取的顺序为：</p>
</div><div class="cl-preview-section"><ul>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">在页面加载时，首先读取用户信息计算用户享受的折扣率</p>
<pre class="  language-js"><code class="prism  language-js">  <span class="token comment">/**
   * 生命周期函数--监听页面加载
   */</span>
  onLoad<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//计算用户享受的折扣率</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDiscount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 根据用户等级与是否付费会员计算用户享受的折扣率
   */</span>
  getDiscount<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token comment">//调用数据服务获取用户的用户等级与付费会员有效期</span>
    levelService<span class="token punctuation">.</span><span class="token function">getLevelList</span><span class="token punctuation">(</span>
      <span class="token comment">//获取成长体系中的所有成长等级回调函数</span>
      <span class="token keyword">function</span><span class="token punctuation">(</span>levelList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> levels <span class="token operator">=</span> levelList
        userService<span class="token punctuation">.</span><span class="token function">getUserInfo</span><span class="token punctuation">(</span>
          <span class="token comment">//获取用户信息回调函数</span>
          <span class="token keyword">function</span><span class="token punctuation">(</span>userinfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> myInfo <span class="token operator">=</span> userinfo
            <span class="token comment">//获取用户等级</span>
            <span class="token keyword">var</span> myLevel <span class="token operator">=</span> levels<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>minGrowthValue <span class="token operator">&lt;=</span> myInfo<span class="token punctuation">.</span>growthValue <span class="token operator">&amp;&amp;</span> myInfo<span class="token punctuation">.</span>growthValue <span class="token operator">&lt;=</span> e<span class="token punctuation">.</span>maxGrowthValue<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token comment">//根据付费会员有效期计算用户是否是小M卡会员</span>
            <span class="token keyword">var</span> isMembershipExpired <span class="token operator">=</span> myInfo<span class="token punctuation">.</span>memberExpDate <span class="token operator">&lt;</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">//设置用户是否是小M卡会员的标志</span>
            that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              isMembershipExpired<span class="token punctuation">:</span> isMembershipExpired<span class="token punctuation">,</span>
              myInfo<span class="token punctuation">:</span> myInfo
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isMembershipExpired<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">//如果用户是在有效期的小M卡会员，设置小M卡会员折扣</span>
              that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                discount<span class="token punctuation">:</span> MEMBERSHIPDISCOUNT
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>myLevel<span class="token punctuation">.</span>bonus<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">//如果用户不是小M卡会员，设置用户当前等级对应的折扣</span>
              that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                discount<span class="token punctuation">:</span> myLevel<span class="token punctuation">.</span>bonus<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>discount
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//读取购物车中商品数据</span>
            that<span class="token punctuation">.</span><span class="token function">initCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">//计算购物车每个商品的价格</span>
            that<span class="token punctuation">.</span><span class="token function">calPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
</li>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">从微信客户端的购物车数据缓存中读取购物车商品数据</p>
<p style="font-size: 20px; line-height: 38px;">购物车数据存储在微信客户端的数据缓存中，使用小程序官方提供的数据缓存 API 读取（数据缓存 API 的使用方法请回顾本章第四节内容）：</p>
<pre class="  language-js"><code class="prism  language-js">  <span class="token comment">/**
   * 从微信客户端的购物车数据缓存中读取购物车商品数据
   */</span>
  initCart<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> value <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        cart<span class="token punctuation">:</span> value
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
</li>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">根据用户享受的折扣率计算购物车中每个商品的价格</p>
<pre class="  language-js"><code class="prism  language-js">  <span class="token comment">/**
   * 根据用户享受的折扣率计算购物车中每个商品的价格
   */</span>
  <span class="token function">calPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//购物车中所有商品原价合计</span>
    <span class="token keyword">var</span> totalPrice <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment">//购物车中所有商品折扣价合计</span>
    <span class="token keyword">var</span> totalDiscountedPrice <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">var</span> cart <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>cart
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>cart<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cart<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>price <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>cart<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>price<span class="token punctuation">)</span> <span class="token comment">//商品原价</span>
      cart<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>discountedPrice <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>cart<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>price <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>discount<span class="token punctuation">)</span> <span class="token comment">//根据折扣计算商品折扣价</span>
      totalPrice <span class="token operator">+=</span> cart<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>price <span class="token comment">//原价合计</span>
      totalDiscountedPrice <span class="token operator">+=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>cart<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>price <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>discount<span class="token punctuation">)</span> <span class="token comment">//折扣价合计</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//设置商品价格数据</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      cart<span class="token punctuation">:</span> cart<span class="token punctuation">,</span>
      totalDiscountedPrice<span class="token punctuation">:</span> totalDiscountedPrice<span class="token punctuation">,</span>
      totalPrice<span class="token punctuation">:</span> totalPrice
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
</li>
</ul>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>请参照前面章节的内容自行添加数据服务引用。</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">在 WXML 页面模板中我们需要定义在什么条件下显示哪些子部件，除与上一节类似的支付结果显示隐藏外，底部操作栏在购物车缓存中没有商品数据时应该隐藏。</p>
</div><div class="cl-preview-section"><pre class="  language-html"><code class="prism  language-html"><span class="token comment">&lt;!-- 不显示支付结果时，才显示子部件 1、2 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{!showPaySuccess &amp;&amp; !showPayFaild}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 子部件 1 ：购物车清单栏 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-panel weui-panel_access<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 子部件 2 ：底部操作栏  购物车中有商品时才显示--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{cart.length &gt; 0}}<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cu-bar bg-white tabbar border shop bottom_pay_button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 当支付接口返回支付成功时，显示支付成功结果 --&gt;</span>
<span class="token comment">&lt;!-- 子部件 3 ：显示支付成功结果 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{showPaySuccess}}<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-msg bg-white padding<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 当支付接口返回支付失败时，显示支付失败结果 --&gt;</span>
<span class="token comment">&lt;!-- 子部件 4 ：显示支付失败结果 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{showPayFaild}}<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-msg bg-white padding<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre>
</div><div class="cl-preview-section"><h3 id="实现子部件-1-：购物车清单栏">2.2 实现子部件 1 ：购物车清单栏</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">子部件 1 的标题与清空按钮在一行左右显示，使用 WeUI 的 Flex 组件实现布局。清空按钮使用 ColorUI 的图标元素 <code>icon-delete</code> ：</p>
</div><div class="cl-preview-section"><pre class="  language-html"><code class="prism  language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-panel__hd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-flex<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 标题 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-flex__item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            购物车
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 清空按钮 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-flex__item text-right<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>icon-delete<span class="token punctuation">"</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>clearCart<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">清空按钮的点击事件为清空购物车数据缓存中的所有商品：</p>
</div><div class="cl-preview-section"><pre class="  language-js"><code class="prism  language-js">  <span class="token comment">/**
   * 清空购物车数据
   */</span>
  clearCart<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//清空购物车的显示数据</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      cart<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//缓存中清除购物车数据</span>
    wx<span class="token punctuation">.</span><span class="token function">removeStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      key<span class="token punctuation">:</span> <span class="token string">'cart'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">购物车商品列表使用条件渲染显示。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">列表中的每个商品分左中右三栏水平显示，使用 WeUI 的 Flex 组件，设置中间元素为 <code>weui-flex__item</code> 即可实现布局。</p>
</div><div class="cl-preview-section"><pre class="  language-html"><code class="prism  language-html"><span class="token comment">&lt;!-- 商品列表 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-panel__bd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 使用条件渲染显示购物车中的每个商品 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{cart}}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{item.index}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-cell weui-cell_access<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-cell__bd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	    <span class="token comment">&lt;!-- 每个商品分左中右三栏水平显示，使用 WeUI 的 Flex 组件实现 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-flex<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
		  <span class="token comment">&lt;!-- 左侧栏显示商品图片 --&gt;</span>
		  <span class="token comment">&lt;!-- 左侧栏点击后页面跳转商品详情页面 --&gt;</span>		  
		  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>navigator</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../product/product?index={{item.index}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>product_thumbnail_image<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{item.smallcoverimg}}<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
		  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>navigator</span><span class="token punctuation">&gt;</span></span>
		  <span class="token comment">&lt;!-- 中间栏显示商品信息 --&gt;</span>
          <span class="token comment">&lt;!-- 在中间栏设置class="weui-flex__item"实现左中右三栏水平显示效果 --&gt;</span>
		  <span class="token comment">&lt;!-- 中间栏点击后页面跳转商品详情页面 --&gt;</span>		  
		  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>navigator</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../product/product?index={{item.index}}<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-flex__item margin-lr-sm<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-lg<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{item.bookname}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-sm<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
			  <span class="token comment">&lt;!-- 与本章第六节类似，根据不同的条件显示不同的商品价格 --&gt;</span>	
			  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{isMembershipExpired &amp;&amp; discount &lt; 1}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-red<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
				  折扣价 p{{item.discountedPrice}}
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
				  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>line_through<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 原价 p{{item.price}} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
			  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">&gt;</span></span>
			  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{!isMembershipExpired}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-red<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
				  小M卡专享价 p{{ item.discountedPrice }}
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
				  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>line_through<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 原价 p{{item.price}} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
			  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">&gt;</span></span>
			  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{isMembershipExpired &amp;&amp; discount == 1}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-red<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
				  限时特价 p{{item.discountedPrice}}
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
			  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>navigator</span><span class="token punctuation">&gt;</span></span>
		  <span class="token comment">&lt;!-- 右侧栏显示删除图标--&gt;</span>
		  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-xs<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>icon-delete<span class="token punctuation">"</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>deleteProductFromCart<span class="token punctuation">'</span></span> <span class="token attr-name">data-item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{item}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
		  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
	  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">右侧删除图标的点击事件为：从微信客户端的购物车缓存中去除该商品，并刷新显示购物车商品列表：</p>
</div><div class="cl-preview-section"><pre class="  language-js"><code class="prism  language-js">  <span class="token comment">/**
   * 删除购物车数据
   */</span>
  deleteProductFromCart<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//获取用户点击的是哪个商品的删除图标</span>
    <span class="token keyword">var</span> productIndex <span class="token operator">=</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>item<span class="token punctuation">.</span>index
    <span class="token comment">//从缓存读取购物车数据</span>
    <span class="token keyword">var</span> value <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//在缓存数据中查找到要删除的商品</span>
      <span class="token keyword">var</span> product <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>index <span class="token operator">==</span> productIndex<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>product<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//得到要删除的商品在购物车缓存中的索引号</span>
        <span class="token keyword">var</span> index <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>product<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">//根据索引号在购物车缓存中删除商品</span>
          value<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token comment">//更新购物车的显示数据</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            cart<span class="token punctuation">:</span> value
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">//将最新的购物车数据更新到本地缓存</span>
          wx<span class="token punctuation">.</span><span class="token function">setStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            key<span class="token punctuation">:</span> <span class="token string">"cart"</span><span class="token punctuation">,</span>
            data<span class="token punctuation">:</span> value<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token comment">//在删除购物车中的商品后，需要重新计算商品原价合计、折扣价合计</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refreshPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
</div><div class="cl-preview-section"><h3 id="实现子部件-2-：底部操作栏">2.3 实现子部件 2 ：底部操作栏</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">与第六节的底部操作栏类似，样式可以在 ColorUI 的操作条组件中找到，简单修改 ColorUI Demo 小程序的代码即可实现 WXML 页面模板：</p>
</div><div class="cl-preview-section"><pre class="  language-html"><code class="prism  language-html"><span class="token comment">&lt;!-- 子部件 2 ：底部操作栏  购物车中有商品时才显示--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{cart.length &gt; 0}}<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cu-bar bg-white tabbar border shop bottom_pay_button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>action<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>总计<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-red<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>p{{totalPrice}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>action<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>折扣<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-red<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>p{{totalPrice - totalDiscountedPrice}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>action<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>实际支付<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-red<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>p{{totalDiscountedPrice}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>onPayButtonClick<span class="token punctuation">'</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bg-red submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>结算<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">使用自定义样式 <code>bottom_pay_button</code> 实现固定在页面底部显示。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">子部件 2 中结算按钮点击事件的实现逻辑与实现代码，与第七章第五节付费会员支付按钮完全一致，区别仅在于调用的支付接口名称不同，传递的参数不同。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">在结算按钮点击事件中传递的参数是商品 ID 数组，可从购物车的商品数据中得到：</p>
</div><div class="cl-preview-section"><pre class="  language-js"><code class="prism  language-js"><span class="token comment">//商品 ID 数组</span>
<span class="token keyword">var</span> productsIndex <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>cart<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//将购物车每个商品的商品 ID 添加到商品 ID 数组</span>
    productsIndex<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>cart<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">请各位同学参考第七章第五节的代码自行实现结算按钮的点击事件 <code>onPayButtonClick</code> ，也可参考专栏源代码的 <code>cart.js</code> 文件，具体代码位置见本节末尾图 17。</p>
</div><div class="cl-preview-section"><h3 id="实现子部件-3-与子部件-4">2.4 实现子部件 3 与子部件 4</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">子部件 3 与 子部件 4 的实现请参考第七章第五节 “2.7 实现子部件 6 与 子部件 7 ：显示支付结果” 或专栏源代码。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>由于篇幅所限，包含完整样式的 WXML 页面模板代码请查阅专栏源代码 cart.wxml 与 cart.wxss ，完整的 JS 逻辑代码见 cart.js ，具体代码位置见本节末尾图 17 。</strong></p>
</div><div class="cl-preview-section"><h2 id="专栏源代码" style="font-size: 30px;">3. 专栏源代码</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">本专栏源代码已上传到 GitHub ，请访问以下地址获取：</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><a href="https://github.com/liujiec/Membership-ECommerce-Miniprogram">https://github.com/liujiec/Membership-ECommerce-Miniprogram</a></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">本节源代码内容在图 17 红框标出的位置。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>图 17 本节源代码位置</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img class="" src="https://img.mukewang.com/5d6b646d000115a406570616.png" data-original="//img.mukewang.com/5d6b646d000115a406570616.png" alt="图片描述"></p>
</div><div class="cl-preview-section"><h2 id="下节预告" style="font-size: 30px;">下节预告</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">下一节，我们将实现商城的最后一个功能页面，订单列表页面。</p>
</div><div class="cl-preview-section"><h2 id="实践环节" style="font-size: 30px;">实践环节</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">实践是通往大神之路的唯一捷径。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">本节实操内容：</p>
</div><div class="cl-preview-section"><ul>
<li style="font-size: 20px; line-height: 38px;"><strong>请结合第二章第三节对 “分类拆解法” 的详细讲解内容，拆解本节图 16 的购物车页面，然后将自己的拆解结果与本节列出的拆解结果进行对照总结。</strong></li>
<li style="font-size: 20px; line-height: 38px;"><strong>编写代码完成购物车页面，如碰到问题，请阅读本专栏源代码学习如何实现。</strong></li>
</ul>
</div>}
                        </div>
                    </div>
                                            <!-- 买过的阅读 -->
                        <div class="art-next-prev clearfix">
                                                                                                <!-- 已买且开放 或者可以试读 -->
                                    <a href="/read/40/article/592">
                                                                    <div class="prev l clearfix">
                                        <div class="icon l">
                                            <i class="imv2-arrow3_l"></i>
                                        </div>
                                        <p>
                                            33 让用户掏钱：开发实现商城商品详情页面
                                        </p>
                                    </div>
                                </a>
                                                                                                                            <!-- 已买且开放 或者可以试读 -->
                                    <a href="/read/40/article/594">
                                                                    <div class="next r clearfix">
                                        <p>
                                            35 给用户看账单：开发实现订单列表页面
                                        </p>
                                        <div class="icon r">
                                            <i class="imv2-arrow3_r"></i>
                                        </div>

                                    </div>
                                </a>
                                                    </div>
                                    </div>
                <div class="comments-con js-comments-con" id="coments_con">
                </div>

                
            </div>
            
            
            

        </div>
    </div>
</div>

<div class="modal modal-jiaQun-new hide" id="modal-jiaQun">
    <div class="inner" style="">
        <div class="modal-close js-close-jiaQun">
            <i class="imv2-close"></i>
        </div>
        <div class="content">
            <img src="https://img3.mukewang.com/5d5a70850001363505400600.jpg">
            <div class="right-info">
                <div class="title">
                    扫码加入慕课前端核心用户群
                </div>
                <div class="desc">
                                            <p class="mb6">验证信息：<span id="joincode">1907191830328156</span><span class="copy js-copy-joincode">复制</span></p>
                                        <p class="mb6">QQ讨论群号：722466314</p>
                                            <p>QQ群URL：<a href="https://jq.qq.com/?_wv=1027&amp;k=5l9EFfc" target="_blank">点击访问</a></p>
                                    </div>
            </div>
            <p class="tip">若遇到搜索不到QQ群或加群失败，请联系客服邮箱:kf@imooc.com</p>
        </div>
    </div>
</div>
 
<!-- 专栏介绍页专栏评价 -->

<!-- 专栏介绍页底部三条评价 -->

<!-- 专栏阅读页弹层目录和介绍页页面目录 -->

<!-- 专栏阅读页发布回复 -->

<!-- 专栏阅读页发布评论 -->

<!-- 专栏阅读页底部评论 -->

<!-- 专栏阅读 单个 评论 -->

<!-- 新增回复和展开三条以外回复 -->

<!-- 立即订阅的弹窗 -->












</div></body></html>