<html><head><meta charset="utf-8"><title>09 云函数与表单校验组件让表单提交如此简单-慕课专栏</title>
			<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
			<meta name="renderer" content="webkit">
			<meta property="qc:admins" content="77103107776157736375">
			<meta property="wb:webmaster" content="c4f857219bfae3cb">
			<meta http-equiv="Access-Control-Allow-Origin" content="*">
			<meta http-equiv="Cache-Control" content="no-transform ">
			<meta http-equiv="Cache-Control" content="no-siteapp">
			<link rel="apple-touch-icon" sizes="76x76" href="https://www.imooc.com/static/img/common/touch-icon-ipad.png">
			<link rel="apple-touch-icon" sizes="120x120" href="https://www.imooc.com/static/img/common/touch-icon-iphone-retina.png">
			<link rel="apple-touch-icon" sizes="152x152" href="https://www.imooc.com/static/img/common/touch-icon-ipad-retina.png">
			<link href="https://moco.imooc.com/captcha/style/captcha.min.css" rel="stylesheet">
			<link rel="stylesheet" href="https://www.imooc.com/static/moco/v1.0/dist/css/moco.min.css?t=201907021539" type="text/css">
			<link rel="stylesheet" href="https://www.imooc.com/static/lib/swiper/swiper-3.4.2.min.css?t=201907021539">
			<link rel="stylesheet" href="../zhuanlanChapter-less.css?v=201907051055" type="text/css">
			<link charset="utf-8" rel="stylesheet" href="https://www.imooc.com/static/lib/ueditor/themes/imooc/css/ueditor.css?v=201907021539"><link rel="stylesheet" href="https://www.imooc.com/static/lib/baiduShare/api/css/share_style0_16.css?v=6aba13f0.css"></head>
			<body><div id="main">

<div class="container clearfix" id="top" style="display: block; width: 1134px;">
    
    <div class="center_con js-center_con l" style="width: 1134px;">
        <div class="article-con">
                            <!-- 买过的阅读 -->
                <div class="map">
                    <a href="/read" target="_blank"><i class="imv2-feather-o"></i></a>
                    <a href="/read/40" target="_blank">零基础实现微信电商小程序开发</a>
                    <a href="" target="_blank">
                        <span>
                            / 3-3 09 云函数与表单校验组件让表单提交如此简单
                        </span>
                    </a>
                </div>

            


            <div class="art-title" style="margin-top: 0px;">
                09 云函数与表单校验组件让表单提交如此简单
            </div>
            <div class="art-info">
                
                <span>
                    更新时间：2019-07-11 15:01:21
                </span>
            </div>
            <div class="art-top">
                                <img src="https://img.mukewang.com/5d1eea1d0001573e06400359.jpg" alt="">
                                                <div class="famous-word-box">
                    <img src="https://www.imooc.com/static/img/column/bg-l.png" alt="" class="bg1 bg">
                    <img src="https://www.imooc.com/static/img/column/bg-r.png" alt="" class="bg2 bg">
                    <div class="famous-word">人的差异在于业余时间。<p class="author">——爱因斯坦</p></div>
                </div>
                            </div>
            <div class="art-content js-lookimg">
                <div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">上一节我们学习了使用云开发数据库实现一个带数据交互的页面。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">前面两小节的内容主要集中在向用户显示内容，在小程序开发中还有一个常用场景-输入界面，即用户输入内容。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">本节，我们就来讲解如何编写供用户输入数据的表单页面、如何验证表单输入数据是否正确、如何提交表单以及使用云开发中的云函数快速实现自动登录能力。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">第一个实践内容是表单，如图 15 所示。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>图 15 表单Demo</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d20778a0001aaf904141342.png" alt="图片描述" data-original="http://img.mukewang.com/5d20778a0001aaf904141342.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><h2 id="表单页面" style="font-size: 30px;">1. 表单页面</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">用户输入内容主要分为两类：</p>
</div><div class="cl-preview-section"><ul>
<li style="font-size: 20px; line-height: 38px;">一类是填写个人信息，如注册表单等。这类表单包含文本框- input、单选列表项- radio 、复选列表项- checkbox 等（见图 15）；</li>
<li style="font-size: 20px; line-height: 38px;">一类是发表评论、动态，填写个人简介等内容。这类表单主要包含文本域- textarea （见图 15）。</li>
</ul>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">在小程序官方组件中已经包含了开发中常用的各种表单输入组件。<strong>小程序表单组件在微信官方的“小程序开发文档”中有详细介绍，文档位置如下：</strong></p>
</div><div class="cl-preview-section"><ul>
<li style="font-size: 20px; line-height: 38px;">入口网址：<a href="https://developers.weixin.qq.com/miniprogram/dev/component/button.html">小程序表单组件</a>，如果微信官方文档改版导致链接失效，请按图索骥。</li>
<li style="font-size: 20px; line-height: 38px;">入口位置：在“小程序开发文档”首页，如图 16 红框标出部分。</li>
</ul>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>图 16 小程序表单组件文档位置</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d2077d0000146ba09740772.png" alt="图片描述" data-original="http://img.mukewang.com/5d2077d0000146ba09740772.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">同时，<strong>在“小程序开发文档”的“体验小程序”一节中也有这些组件的小程序Demo及源代码（见本章第一节图 8 ）。</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>而WeUI中则提供了表单页面布局的具体方案，包括 button 、list 、input 等组件，如图 17 所示。WeUI的小程序Demo及源代码请回顾本章第一节 2.1 UI框架。</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>图 17 WeUI表单布局组件</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d2077f60001477004140737.png" alt="图片描述" data-original="http://img.mukewang.com/5d2077f60001477004140737.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">因此，学习小程序表单开发的第一步，是先阅读“小程序开发文档”中表单组件的内容，结合小程序组件 Demo 、WeUI Demo及其源代码，学会各个表单组件的使用语法和表单界面布局。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>另外，本专栏也编写了一个完整的表单Demo供各位同学参考，源代码位置见本节 “ 6. 专栏源代码”。</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">对一些需要特殊处理的表单组件，在这里选取本专栏源代码中的对应代码片段做一个简要说明，方便各位同学理解。</p>
</div><div class="cl-preview-section"><h3 id="密码输入框">1.1 密码输入框</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">密码输入框需要隐藏用户数据的密码，这需要在 input 组件中设置 <code>password="true"</code> 。</p>
</div><div class="cl-preview-section"><pre class="  language-html"><code class="prism  language-html"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{ password }}<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre>
</div><div class="cl-preview-section"><h3 id="单选列表项--radio">1.2 单选列表项- radio</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">radio 组件需要首先在 JS 逻辑的 data 中设置每个选项的值 <code>radio</code> 。同时定义一个数据 <code>gender</code> 用于保存用户的选择。这样当我们进行表单校验、或向云数据库提交表单数据时就可以直接使用 <code>gender</code> ，而不必每次都去查找 radio 组件中哪个选项的 <code>checked=true</code> ：</p>
</div><div class="cl-preview-section"><pre class="  language-js"><code class="prism  language-js">  <span class="token comment">/**
   * 页面的初始数据
   */</span>
  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    gender<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    radio<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">'男'</span><span class="token punctuation">,</span>
        value<span class="token punctuation">:</span> <span class="token string">'male'</span><span class="token punctuation">,</span>
        checked<span class="token punctuation">:</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">'女'</span><span class="token punctuation">,</span>
        value<span class="token punctuation">:</span> <span class="token string">'female'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">然后在 WXML 页面模板中使用 “列表渲染”（语法见第二节 4.4 实现页面显示列表数据），并复制WeUI 中 input  组件提供的样式显示每个选项，同时需要绑定一个事件 <code>bindchange="radioChange"</code> 来响应用户点击选项的动作：</p>
</div><div class="cl-preview-section"><pre class="  language-html"><code class="prism  language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>radio-group</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>gender<span class="token punctuation">"</span></span> <span class="token attr-name">bindchange</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radioChange<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-cell weui-check__label<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{radio}}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>value<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>radio</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-check<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{item.value}}<span class="token punctuation">"</span></span> <span class="token attr-name">checked</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{item.checked}}<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-cell__bd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{item.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-cell__ft weui-cell__ft_in-radio<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{item.checked}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>icon</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-icon-radio<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>success_no_circle<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>16<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>icon</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>radio-group</span><span class="token punctuation">&gt;</span></span>
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">最后还需要在 JS 逻辑编写用户点击选项的事件函数 <code>radioChange</code> ，来实现用户点击的选项被选中的效果：</p>
</div><div class="cl-preview-section"><pre class="  language-js"><code class="prism  language-js">  <span class="token comment">/**
   * radio改变时刷新data中的值
   */</span>
  <span class="token function">radioChange</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value
    <span class="token keyword">const</span> radio <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>radio
    <span class="token comment">//Object.assign是ES6语法，感兴趣的同学可在网上搜索ES6具体了解</span>
    <span class="token comment">//其他同学只需要记住这样写实现的操作是：</span>
    <span class="token comment">//将用户当前选中的选项设置checked=true，其他选项设置checked=false</span>
    <span class="token comment">//当然这个操作也可以用for循环实现，这作为一个实践作业，请各位同学尝试改写为for循环实现</span>
    <span class="token keyword">const</span> items <span class="token operator">=</span> radio<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        checked<span class="token punctuation">:</span> n<span class="token punctuation">.</span>value <span class="token operator">===</span> value<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      radio<span class="token punctuation">:</span> items<span class="token punctuation">,</span>
      gender<span class="token punctuation">:</span> value<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>小程序每个组件都有自己的事件定义，在“小程序开发文档”中类型是 <code>EventHandle</code> 的属性就是事件。</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>要完整地理解小程序的事件系统，请参阅微信官方“小程序开发文档”的<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html">“指南”-&gt;“小程序框架”-&gt;“视图层”-&gt;“事件系统”</a>小节。</strong></p>
</div><div class="cl-preview-section"><h3 id="复选列表项--checkbox">1.3 复选列表项- checkbox</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">checkbox 组件的使用方法类似 radio ，实现代码请阅读本专栏源代码  <code>demo/pages/06_form</code>  中的“技能（复选列表项-checkbox）”（页面位置见图 15）。</p>
</div><div class="cl-preview-section"><h3 id="选择--picker">1.4  选择- picker</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">picker 组件有多种用法，详细介绍请阅读“小程序开发文档”中的介绍、小程序组件Demo源代码及本专栏源代码。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这里仅介绍最常用的时间选择器的使用方法。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">首先在 JS 逻辑的 data 中定义一个数据 <code>date</code> 用于保存用户选择的时间：</p>
</div><div class="cl-preview-section"><pre class="  language-js"><code class="prism  language-js">  <span class="token comment">/**
   * 页面的初始数据
   */</span>
  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    date<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">然后在 WXML 页面模板中复制 WeUI 中 input 组件提供的样式，并设置 picker 组件为时间选择器 <code>mode="date"</code> ，同时需要绑定一个事件 <code>bindchange="bindDateChange"</code> 来响应用户选择时间的动作：</p>
</div><div class="cl-preview-section"><pre class="  language-html"><code class="prism  language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-cell__bd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>picker</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>date<span class="token punctuation">"</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>date<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{date}}<span class="token punctuation">"</span></span> <span class="token attr-name">start</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2015-09-01<span class="token punctuation">"</span></span> <span class="token attr-name">end</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2017-09-01<span class="token punctuation">"</span></span> <span class="token attr-name">bindchange</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bindDateChange<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-input<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{date}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>picker</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">最后还需要在  JS 逻辑 编写用户选择时间的事件函数 <code>bindDateChange</code> ，来记录并在界面中显示用户选择的时间：</p>
</div><div class="cl-preview-section"><pre class="  language-js"><code class="prism  language-js">  <span class="token comment">/**
   * 出生日期改变时刷新data中的值
   */</span>
  bindDateChange<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      date<span class="token punctuation">:</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
</div><div class="cl-preview-section"><h2 id="表单验证" style="font-size: 30px;">2. 表单验证</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">在我们完成表单页面的显示后，还需要对用户输入的表单数据进行校验及错误提示，比如对必须输入内容的组件判断用户是否未输入内容，如用户未输入内容在界面中提示用户该组件是必填项。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">微信官方并未提供表单验证功能，但<strong>目前在 GitHub 上已经有了一些开源的小程序表单验证组件。其中一个比较完善的表单验证组件是"WxValidate - 表单验证"。</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">该组件的源代码可从如下地址获取： <a href="https://github.com/skyvow/wx-extend">https://github.com/skyvow/wx-extend</a>，在该组件的 GitHub 项目主页有组件的使用介绍。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>同时，本专栏的源代码中也包含了该组件，位于 <code>demo/pages/utils/validate</code> 目录中。该组件的完整使用示例包含在本专栏源代码的 <code>demo/pages/06_form</code> 中，本专栏的示例对源项目的错误提示做了改进，结合了 WeUI 组件 input 中的错误提示样式。</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>图 18 本专栏示例的表单错误提示效果</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d2078330001673204140737.png" alt="图片描述" data-original="http://img.mukewang.com/5d2078330001673204140737.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这里以实现“姓名”这个文本框的表单校验为例来介绍表单校验的实现方式，如何完整实现如图 18 所示的表单校验效果，请阅读本专栏源代码。</p>
</div><div class="cl-preview-section"><ul>
<li style="font-size: 20px; line-height: 38px;">2.1 首先需要在 JS 逻辑中引用表单验证组件，见 JS 逻辑源代码注释 2.1 部分；</li>
<li style="font-size: 20px; line-height: 38px;">2.2 设置页面的初始数据，见 JS 逻辑源代码注释 2.2 部分；</li>
<li style="font-size: 20px; line-height: 38px;">2.3 在页面加载时（即 <code>onLoad</code> 事件中）设置表单的验证规则 <code>rules</code> 和 验证规则对应的错误提示信息 <code>messages</code>，见 JS 逻辑源代码注释 2.3 部分；</li>
<li style="font-size: 20px; line-height: 38px;">2.4 定义表单提交事件 <code>submitForm</code> 在用户点击提交表单按钮式进行表单校验。表单校验的具体流程为：首先调用表单验证组件，如果表单验证组件返回验证失败，则在 <code>errorMap</code> 中记录表单验证出的所有错误信息，在 <code>errorMap</code> 中包含错误信息的输入组件会将自己的标题设置为红色；第二步是将错误信息的第一条内容记录到 <code>error</code> 中作为在页面顶部显示的错误信息内容，然后在页面顶部显示3秒错误信息内容；如果表单验证组件返回验证成功，弹出提示框提示表单验证成功，见 JS 逻辑源代码注释 2.4 部分。</li>
</ul>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>JS 逻辑源代码</strong></p>
</div><div class="cl-preview-section"><pre class="  language-js"><code class="prism  language-js"><span class="token comment">//2.1 </span>
<span class="token comment">//引用表单验证组件"WxValidate - 表单验证"</span>
<span class="token keyword">import</span> WxValidate <span class="token keyword">from</span> <span class="token string">'../../utils/validate/WxValidate.js'</span>
<span class="token comment">//2.1 </span>

<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>

<span class="token comment">//2.2 </span>
  <span class="token comment">/**
   * 设置页面的初始数据
   */</span>
  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">//记录用户输入的姓名</span>
    error<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token comment">//页面顶部的错误提示显示内容</span>
    errorMap<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//记录表单验证发现的所有错误，用于界面显示错误提示</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">//2.2 </span>

<span class="token comment">//2.3 </span>
  <span class="token comment">/**
   * 生命周期函数--监听页面加载
   */</span>
  onLoad<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//在页面加载时设置表单的验证规则</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initValidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 设置表单的验证规则
   */</span>
  <span class="token function">initValidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//验证规则</span>
    <span class="token keyword">const</span> rules <span class="token operator">=</span> <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        required<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//必填字段</span>
        minlength<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>   <span class="token comment">//最小长度为2个字</span>
        maxlength<span class="token punctuation">:</span> <span class="token number">4</span>    <span class="token comment">//最大长度为4个字</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 验证规则对应的错误提示信息</span>
    <span class="token keyword">const</span> messages <span class="token operator">=</span> <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        required<span class="token punctuation">:</span> <span class="token string">'请输入姓名'</span><span class="token punctuation">,</span>
        minlength<span class="token punctuation">:</span> <span class="token string">'姓名最少2个字'</span><span class="token punctuation">,</span>
        maxlength<span class="token punctuation">:</span> <span class="token string">'姓名最多4个字'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 创建"WxValidate - 表单验证"组件的实例对象</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>WxValidate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WxValidate</span><span class="token punctuation">(</span>rules<span class="token punctuation">,</span> messages<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">//2.3 </span>

<span class="token comment">//2.4</span>
  <span class="token comment">/**
   * 点击提交表单时进行表单验证
   */</span>
  <span class="token function">submitForm</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value

    <span class="token comment">// 传入表单数据，调用表单验证方法</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>WxValidate<span class="token punctuation">.</span><span class="token function">checkForm</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//如果表单验证失败，记录表单验证出的所有错误信息</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setErrorMap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>WxValidate<span class="token punctuation">.</span>errorList<span class="token punctuation">)</span>
      <span class="token comment">//设置页面顶部要显示的错误信息内容</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        error<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>WxValidate<span class="token punctuation">.</span>errorList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>msg
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">//在页面顶部显示3秒错误信息内容</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showTopTips</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
	
    <span class="token comment">//如果表单验证成功，进行提示</span>
    wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">'验证结果'</span><span class="token punctuation">,</span>
      content<span class="token punctuation">:</span> <span class="token string">'验证成功'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 记录表单验证出的所有错误信息，供页面将输入错误区域的标题设置为红色
   */</span>
  setErrorMap<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> index <span class="token keyword">in</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      map<span class="token punctuation">[</span>e<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>param<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>msg<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      errorMap<span class="token punctuation">:</span> map
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 在页面顶部显示3秒错误信息内容
   */</span>
  showTopTips<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      showTopTips<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        showTopTips<span class="token punctuation">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">//2.4</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
</div><div class="cl-preview-section"><ul>
<li style="font-size: 20px; line-height: 38px;">2.5 在 WXML 页面模板添加页面顶部的错误提示区域，见 WXML 页面模板源代码 2.5 部分；</li>
<li style="font-size: 20px; line-height: 38px;">2.6 在 WXML 页面模板添加一个表单组件 form ，并设置它的表单提交事件为 2.4 中定义的事件。另外添加一个表单提交按钮，以触发表单提交事件。见 WXML 页面模板源代码 2.6 部分；</li>
<li style="font-size: 20px; line-height: 38px;">2.7 在 WXML 页面模板添加一个姓名输入框，并添加根据表单校验结果将输入错误区域的标题设置为红色的判断 <code>{{ errorMap['name']?'weui-cell_warn':'' }}</code> ，见 WXML 页面模板源代码 2.7 部分。</li>
</ul>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>WXML 页面模板源代码</strong></p>
</div><div class="cl-preview-section"><pre class="  language-html"><code class="prism  language-html"><span class="token comment">&lt;!-- 2.5 页面顶部的错误提示区域 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-toptips weui-toptips_warn<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{showTopTips}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{error}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 2.6 表单组件 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">bindsubmit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submitForm<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!-- 2.7 姓名输入框 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-cells<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-cell weui-cell_input<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- 2.7 根据表单校验结果将输入错误区域的标题设置为红色 --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-cell__hd  {{ errorMap[<span class="token punctuation">'</span>name<span class="token punctuation">'</span>]?<span class="token punctuation">'</span>weui-cell_warn<span class="token punctuation">'</span>:<span class="token punctuation">'</span><span class="token punctuation">'</span> }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>姓名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-cell__bd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{ name }}<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-input<span class="token punctuation">"</span></span> 
        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>请输入2-4个字的姓名<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!-- 2.6 表单提交按钮 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-btn-area<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>weui-btn<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">formType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>确定<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre>
</div><div class="cl-preview-section"><h2 id="表单提交" style="font-size: 30px;">3. 表单提交</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">表单提交是在表单验证通过后，将用户输入的信息保存到云数据库。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这里以实现“姓名”这个文本框的表单提交为例来介绍表单提交的实现方式，如何完整实现如图 15 所示的表单内容，请阅读本专栏源代码 <code>demo/pages/07_form_submit</code>。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">首先我们需要在云数据库中新建一个数据库集合 <code>form_demo</code> ，新建数据库集合的方法已在上一节中介绍。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">然后我们需要编写提交表单数据到数据库的方法，将用户输入的姓名保存到云数据库，保存成功后提示表单提交成功，并显示存入云数据库的记录ID：</p>
</div><div class="cl-preview-section"><pre class="  language-js"><code class="prism  language-js">  <span class="token comment">/**
   * 保存表单到云数据库
   */</span>
  saveForm<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> db <span class="token operator">=</span> wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//将用户输入的姓名保存到云数据库</span>
    db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'form_demo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token comment">//用户输入的姓名</span>
          name<span class="token punctuation">:</span> params<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
          <span class="token comment">//使用云服务器时间记录表单提交时间</span>
          createTime<span class="token punctuation">:</span> db<span class="token punctuation">.</span><span class="token function">serverDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//提示表单提交成功，并显示存入云数据库的记录ID</span>
        wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          title<span class="token punctuation">:</span> <span class="token string">'提交'</span><span class="token punctuation">,</span>
          content<span class="token punctuation">:</span> <span class="token string">'表单插入数据库成功, ID:'</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>_id<span class="token punctuation">,</span>
          showCancel<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            wx<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              delta<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">最后将 2.4 中的：</p>
</div><div class="cl-preview-section"><pre class="  language-js"><code class="prism  language-js">    <span class="token comment">//如果表单验证成功，进行提示</span>
    wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">'验证结果'</span><span class="token punctuation">,</span>
      content<span class="token punctuation">:</span> <span class="token string">'验证成功'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">修改为提交数据：</p>
</div><div class="cl-preview-section"><pre class="  language-js"><code class="prism  language-js">    <span class="token comment">//如果表单验证成功，提交数据到云数据库</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveForm</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这样在点击提交按钮，通过表单验证后，将提交表单数据到云数据库。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">提交表单数据到云数据库成功后的提示界面如图 19 所示。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>图 19 表单提交成功界面</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d20787c0001164804150736.png" alt="图片描述" data-original="http://img.mukewang.com/5d20787c0001164804150736.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><h2 id="云函数" style="font-size: 30px;">4. 云函数</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">在使用云开发进行小程序应用开发时，还有一个经常会用到的云开发能力-云函数。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">有同学可能会问，到目前为止，我们编写的所有代码都是运行在小程序手机端的，而且看起来小程序手机端+云开发数据库就可以完成一个完整的小程序应用了，云函数有啥用？</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">云函数当然有用，而且有不可替代的作用。云函数的不可替代性在于它是运行在云开发的服务器端的。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">怎么理解呢，我们来举一个例子。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们现在要开发一个积分兑换实物商品的小程序，这个小程序要实现积分消费的功能。积分消费功能首先要查看用户的积分是不是够兑换他想兑换的商品，如果用户有足够的积分，就允许他兑换这个商品。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">如果你把这个积分消费的功能逻辑写在小程序手机端，你可能瞬间变成百万“负”翁。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">因为在小程序手机端你需要向云数据库请求三次数据，第一次是查询用户积分，如果用户积分大于等于兑换商品所需的积分就进行第二次数据库请求：插入一条用户兑换商品的记录，然后再进行第三次数据库请求：将用户的积分减去兑换商品消耗的积分。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这三次请求都是在手机端执行的，那么我就可以通过技术手段，跳过第一次和第三次数据请求，直接进行第二次数据库请求。也就是说，我可以不花一个积分，兑换所有的商品！</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">更惨的是，中国还有庞大的灰产行业链，如果一旦有人发现了这个BUG，几百万薅羊毛的能手，会像闻到血腥味的鲨鱼一样，疯狂利用这个漏洞免费兑换商品。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">想想这个后果吧，你还觉得云函数没有用吗。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">如果将这 3 次数据库请求都写在一个云函数中的，那么小程序手机端只能调用这个云函数来提交积分兑换请求。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">云函数运行在服务器端，这个云函数的3次数据库请求顺序和程序逻辑，在小程序手机端是无法用技术手段篡改或跳过一部分只执行另一部分的。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">这样才能避免被羊毛党吸光血的惨案发生。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">为了你的“钱”途，请认真学习和掌握云函数。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">微信官方的“小程序开发文档”有详细的云函数教程，<strong>云函数教程位置如下：</strong></p>
</div><div class="cl-preview-section"><ul>
<li style="font-size: 20px; line-height: 38px;"><strong>入口网址：<a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/functions.html">云函数教程</a>，如果微信官方文档改版导致链接失效，请按图索骥。</strong></li>
<li style="font-size: 20px; line-height: 38px;"><strong>入口位置：在“小程序开发文档”的“云开发”栏目，如图 20 红框标出部分。</strong></li>
</ul>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>图 20 云函数教程位置</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d2078af00017a7114080972.png" alt="图片描述" data-original="http://img.mukewang.com/5d2078af00017a7114080972.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><h2 id="自动登录" style="font-size: 30px;">5. 自动登录</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">云函数一个最基本也是最广泛的应用场景就是与微信登录鉴权的无缝整合，实现了微信自动登录。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">不使用云开发，实现微信登录获取用户的 OpenId 需要一个复杂的流程，具体有多复杂可以参考“小程序开发文档”中的介绍：<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html">“指南”-&gt;“开放能力”-&gt;“小程序登录”</a>。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">而在云开发中使用云函数，只需要两行代码就可以实现：</p>
</div><div class="cl-preview-section"><pre class="  language-js"><code class="prism  language-js">  <span class="token keyword">const</span> wxContext <span class="token operator">=</span> cloud<span class="token punctuation">.</span><span class="token function">getWXContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    openid<span class="token punctuation">:</span> wxContext<span class="token punctuation">.</span>OPENID
  <span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">云函数实现微信自动登录获取用户 OpenID 的 Demo 在本专栏源代码 <code>demo/pages/08_auto_login</code> 及<code>cloudfunctions/autoLoginDemo</code> ，请结合微信官方的“小程序开发文档”中“获取小程序用户信息”一节阅读并理解云开发中获取用户 OpenID 的方法。</p>
</div><div class="cl-preview-section"><h2 id="专栏源代码" style="font-size: 30px;">6. 专栏源代码</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">本专栏源代码已上传到 GitHub ，请访问以下地址获取：</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><a href="https://github.com/liujiec/Membership-ECommerce-Miniprogram">https://github.com/liujiec/Membership-ECommerce-Miniprogram</a></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">本节源代码内容在图 21 红框标出的位置。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>图 21 本节源代码位置</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img src="http://img.mukewang.com/5d2079270001495c07550745.png" alt="图片描述" data-original="http://img.mukewang.com/5d2079270001495c07550745.png" class="" style="cursor: pointer;"></p>
</div><div class="cl-preview-section"><h2 id="本章小结" style="font-size: 30px;">本章小结</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">在本章，我们以“小程序开发文档”和“分类拆解法”为主线，向各位同学介绍了小程序开发的主要内容，包括页面布局、小程序组件、WeUI组件、云开发数据库创建与操作、表单、云函数。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">只阅读本专栏的内容对入门小程序开发是远远不够的，微信官方的“小程序开发文档”中的内容需要反复阅读、实践、理解。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">本章节已经给出了“小程序开发文档”基础内容的学习顺序，各位同学可以按照本章提到“小程序开发文档”的先后顺序来进行学习。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>请各位同学在完全吸收了本章节内容，以及本章节提到的“小程序开发文档”内容，并完成实践环节后再开始后续章节学习。</strong> 如果不完成这些内容就直接阅读后续章节，很可能导致你出口成“脏”：MD，写的什么啊，根本读不懂。我们都不希望这种情况出现对吧，所以还是要辛苦你在这一章多花花心思了。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">小程序是一个庞大的生态，没有任何一个人能记住小程序开发的所有细节。请不要背诵任何内容，通过不断实践自然会记住并运用越来越多的内容。<strong>在实践中碰到问题，然后解决问题，是学习一本编程语言最快速的方式。</strong></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>所以，请将“小程序开发文档”作为你最重要的工具书，当你碰到任何问题，带着问题到“小程序开发文档”中寻找答案。</strong></p>
</div><div class="cl-preview-section"><h2 id="下节预告" style="font-size: 30px;">下节预告</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">下一节，我们将进入商业项目“会员制社交电商小程序”的编程实战环节，请做好准备：）。</p>
</div><div class="cl-preview-section"><h2 id="实践环节" style="font-size: 30px;">实践环节</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">实践是通往大神之路的唯一捷径。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">本节实操内容：</p>
</div><div class="cl-preview-section"><ul>
<li style="font-size: 20px; line-height: 38px;"><strong>编写代码完成图 15 、图 18、 图 19 所示的页面，如碰到问题，请阅读本专栏源代码学习如何实现。</strong></li>
<li style="font-size: 20px; line-height: 38px;"><strong>编写云函数，实现将用户 OpenID 显示到页面，如碰到问题，请阅读本专栏源代码学习如何实现。</strong></li>
</ul>
</div></div>
            </div>
                            <!-- 买过的阅读 -->
                <div class="art-next-prev clearfix">
                                                                        <!-- 已买且开放 或者可以试读 -->
                            <a href="/read/40/article/566">
                                                    <div class="prev l clearfix">
                                <div class="icon l">
                                    <i class="imv2-arrow3_l"></i>
                                </div>
                                <p>
                                    08 数据交互：云开发让数据库操作如此简单
                                </p>
                            </div>
                        </a>
                                                                                            <!-- 已买且开放 或者可以试读 -->
                            <a href="/read/40/article/568">
                                                    <div class="next r clearfix">
                                <p>
                                    10 功能分析：3大商业小程序标配功能详解
                                </p>
                                <div class="icon r">
                                    <i class="imv2-arrow3_r"></i>
                                </div>

                            </div>
                        </a>
                                    </div>
                    </div>
        <div class="comments-con js-comments-con" id="coments_con">
        </div>



    </div>
    
    
    

</div>
 
<!-- 专栏介绍页专栏评价 -->

<!-- 专栏介绍页底部三条评价 -->

<!-- 专栏阅读页弹层目录和介绍页页面目录 -->

<!-- 专栏阅读页发布回复 -->

<!-- 专栏阅读页发布评论 -->

<!-- 专栏阅读页底部评论 -->

<!-- 专栏阅读 单个 评论 -->

<!-- 新增回复和展开三条以外回复 -->

<!-- 立即订阅的弹窗 -->












</div></body></html>