<html><head><meta charset="utf-8"><title>20 面试官，请不要再问我@Resource和@Autowire注解的区别了-慕课专栏</title>
			<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
			<meta name="renderer" content="webkit">
			<meta property="qc:admins" content="77103107776157736375">
			<meta property="wb:webmaster" content="c4f857219bfae3cb">
			<meta http-equiv="Access-Control-Allow-Origin" content="*">
			<meta http-equiv="Cache-Control" content="no-transform ">
			<meta http-equiv="Cache-Control" content="no-siteapp">
			<link rel="apple-touch-icon" sizes="76x76" href="https://www.imooc.com/static/img/common/touch-icon-ipad.png">
			<link rel="apple-touch-icon" sizes="120x120" href="https://www.imooc.com/static/img/common/touch-icon-iphone-retina.png">
			<link rel="apple-touch-icon" sizes="152x152" href="https://www.imooc.com/static/img/common/touch-icon-ipad-retina.png">
			<link href="https://moco.imooc.com/captcha/style/captcha.min.css" rel="stylesheet">
			<link rel="stylesheet" href="https://www.imooc.com/static/moco/v1.0/dist/css/moco.min.css?t=201907021539" type="text/css">
			<link rel="stylesheet" href="https://www.imooc.com/static/lib/swiper/swiper-3.4.2.min.css?t=201907021539">
			<link rel="stylesheet" href="https://static.mukewang.com/static/css/??base.css,common/common-less.css?t=2.5,column/zhuanlanChapter-less.css?t=2.5,course/inc/course_tipoff-less.css?t=2.5?v=201907051055" type="text/css">
			<link charset="utf-8" rel="stylesheet" href="https://www.imooc.com/static/lib/ueditor/themes/imooc/css/ueditor.css?v=201907021539"><link rel="stylesheet" href="https://www.imooc.com/static/lib/baiduShare/api/css/share_style0_16.css?v=6aba13f0.css"></head>
			<body><div id="main">


<div class="main-con hide-menu">
    <!-- 左侧菜单 & 索引 -->
    
    <div class="right-content" style="padding-left: 0px;">
        <div class="container clearfix" id="top" style="width: 1134px; display: block;">
            
            
            <div class="center_con js-center_con l" style="width: 1134px;">
                <div class="article-con">
                                            <!-- 买过的阅读 -->
                        

                    
                    <div class="art-title" style="margin-top: 0px;">
                        20 面试官，请不要再问我@Resource和@Autowire注解的区别了
                    </div>
                    <div class="art-info clearfix">
                        
                        <span class="l">
                            更新时间：2020-08-04 17:54:54
                        </span>
                    </div>
                    <div class="art-top">
                                                <img src="https://img2.sycdn.imooc.com/5ece0baa0001a5ca06400359.jpg" alt="">
                                                                        <div class="famous-word-box">
                            <img src="https://www.imooc.com/static/img/column/bg-l.png" alt="" class="bg1 bg">
                            <img src="https://www.imooc.com/static/img/column/bg-r.png" alt="" class="bg2 bg">
                            <div class="famous-word">谁和我一样用功，谁就会和我一样成功。——莫扎特<p></p></div>
                        </div>
                                            </div>
                    <div class="art-content js-lookimg">
                        <div id="article_content">
                            <div class="cl-preview-section"><h2 id="背景" style="font-size: 30px;">背景</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">我们平时在写业务代码时会使用一些注解，注解给我们的业务提供了很多便利，但开发者往往不知道这些注解背后的故事，正如本文要讲到的 @Resource 注解一样，如果理解了实现原理，对我们开发由莫大的好处：一是可以更好的利用这些注解及它们的使用场景，不会出现使用错误；二是排查问题更有目标性，提升开发效率；三是面试时再也不担心面试官问我 @Resource 和 @Autowire 的区别了。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">本专栏的另一篇文章：《@Autowired 是如何工作的？——Spring 注解源码深度揭秘》介绍了 Autowired 的实现机制，本篇就重点介绍 @Resource 注解的使用及实现原理。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img class="" src="http://p1.pstatp.com/large/pgc-image/ff76dcc82836462ba858e51609c02cd9" data-original="http://p1.pstatp.com/large/pgc-image/ff76dcc82836462ba858e51609c02cd9" alt="img"></p>
</div><div class="cl-preview-section"><h2 id="实例" style="font-size: 30px;">实例</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">用 @Resource 注解导入的 POJO 类：<br>
<img class="" src="https://img1.sycdn.imooc.com/5eec25d10001d19e05110392.png" data-original="//img1.sycdn.imooc.com/5eec25d10001d19e05110392.png" alt="图片描述"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">导入 Resource 注解类：<br>
<img class="" src="https://img1.sycdn.imooc.com/5eec25e60001123a06400518.png" data-original="//img1.sycdn.imooc.com/5eec25e60001123a06400518.png" alt="图片描述"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">配置文件中使 @Resource 注解生效：<br>
<img class="" src="https://img1.sycdn.imooc.com/5eec25fc0001977606400222.png" data-original="//img1.sycdn.imooc.com/5eec25fc0001977606400222.png" alt="图片描述"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">测试类：<br>
<img class="" src="https://img1.sycdn.imooc.com/5eec260d0001377d06400302.png" data-original="//img1.sycdn.imooc.com/5eec260d0001377d06400302.png" alt="图片描述"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">运行结果：</p>
</div><div class="cl-preview-section"><blockquote>
<p style="font-size: 20px; line-height: 38px;">Employee [id=123456, name=davidwang, company=Company [name=davidwangtest, location=shanghai]]</p>
</blockquote>
</div><div class="cl-preview-section"><h2 id="原理" style="font-size: 30px;">原理</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">配置文件中使用了 annotation-config 来开启 @Resource 注解，那么怎么实现的呢？</p>
</div><div class="cl-preview-section"><pre class="  language-xml"><code class="prism  language-xml"><span class="token comment">&lt;!-- To activate the '@Resource' annotation in the spring framework --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>annotation-config</span> <span class="token punctuation">/&gt;</span></span>
</code></pre>
</div><div class="cl-preview-section"><h3 id="xml-配置文件解析处理器-contextnamespacehandler">1. xml 配置文件解析处理器 ContextNamespaceHandler</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">ContextNamespaceHandler 定义了 XML 配置文件中元素的解析器，这些元素分别是：</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><code>&lt;context:property-placeholder/&gt;</code>元素的解析器 PropertyPlaceholderBeanDefinitionParser；</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><code>&lt;context:property-override&gt;</code>元素的解析器 PropertyOverrideBeanDefinitionParser；</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><code>&lt;context:annotation-config&gt;</code>元素的解析器 AnnotationConfigBeanDefinitionParser；</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><code>&lt;context:component-scan/&gt;</code>元素的解析器 ComponentScanBeanDefinitionParser；</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><code>&lt;context:load-time-weaver/&gt;</code>元素的解析器 LoadTimeWeaverBeanDefinitionParser；</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><code>&lt;context:spring-configured/&gt;</code>元素的解析器 SpringConfiguredBeanDefinitionParser；</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><code>&lt;context:mbean-export/&gt;</code>元素的解析器 MBeanExportBeanDefinitionParser；</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><code>&lt;context:mbean-server/&gt;</code>元素的解析器 MBeanServerBeanDefinitionParser。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">上面每个元素的用法如果想深入了解，需要参照相关资料。本节仅讨论<code>&lt;context:annotation-config&gt;</code>元素的作用。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img class="" src="http://p1.pstatp.com/large/pgc-image/2a8eb505b74d4809a7350442c90aea2c" data-original="http://p1.pstatp.com/large/pgc-image/2a8eb505b74d4809a7350442c90aea2c" alt="img"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><code>&lt;context:annotation-config/&gt;</code>的作用是向 Spring 容器注册各种 BeanPostProcessor，是为了让系统能够识别相应的注解。常用的 BeanPostProcessor 有以下几种：</p>
</div><div class="cl-preview-section"><ul>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">ConfigurationClassPostProcessor：支持 <strong>@Import</strong> 注解；</p>
</li>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">AutowiredAnnotationBeanPostProcessor：支持 <strong>@Autowired</strong> ， <strong>@Value</strong>，<strong>@Inject</strong> 等；</p>
</li>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">CommonAnnotationBeanPostProcessor：支持 JSR-250 注解，其中包括 <strong>@PostConstruct</strong>，<strong>@PreDestroy</strong> 和 <strong>@Resource</strong> 注解；</p>
</li>
<li style="font-size: 20px; line-height: 38px;">
<p style="font-size: 20px; line-height: 38px;">PersistenceAnnotationBeanPostProcessor：支持 JPA 注解；</p>
</li>
</ul>
</div><div class="cl-preview-section"><h3 id="resource-注解实现">2. @Resource 注解实现</h3>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">由 上面的描述，可以知道 CommonAnnotationBeanPostProcessor 实现了 <strong>@Resource</strong> 注解。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">CommonAnnotationBeanPostProcessor 注册的过程如下图所示：</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img class="" src="https://img1.sycdn.imooc.com/5f29306a00019ee216000367.jpg" data-original="//img1.sycdn.imooc.com/5f29306a00019ee216000367.jpg" alt="图片描述"><br>
下面从源码看看链路的主要步骤：<br>
<code>&lt;context:property-placeholder/&gt;</code>元素的解析器 AnnotationConfigBeanDefinitionParser 注册了 CommonAnnotationBeanPostProcessor ，其代码如下：</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><img class="" src="https://img1.sycdn.imooc.com/5f2263cc0001f9a617621591.png" data-original="//img1.sycdn.imooc.com/5f2263cc0001f9a617621591.png" alt="图片描述"></p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">CommonAnnotationBeanPostProcessor 实现 @Resource 注解， 默认按 byName 自动注入。  既不指定 name 属性，也不指定 type 属性，则自动按 byName 方式进行查找。如果没有找到符合的 bean，则回退为一个原始类型进行进行查找，如果找到就注入。<br>
<img class="" src="https://img1.sycdn.imooc.com/5f225ee600014a2213231080.png" data-original="//img1.sycdn.imooc.com/5f225ee600014a2213231080.png" alt="图片描述"></p>
</div><div class="cl-preview-section"><h2 id="总结" style="font-size: 30px;">总结</h2>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>@Autowired、@Inject、@Value 和 @Resource 注释由 Spring BeanPostProcessor 实现处理。</strong> 这意味着你不能在自己的 BeanPostProcessor 或 BeanFactoryPostProcessor 类型（如果有的话）中应用这些注释。要使用这些注解，必须使用 XML 或 Spring 注解 @Bean 的方法显式地声明这些 <strong>BeanPostProcessor</strong>。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">关于**@Autowired 和 @Resource 的应用场景，官方给出的解释如下：**</p>
</div><div class="cl-preview-section"><blockquote>
<p style="font-size: 20px; line-height: 38px;">That said, if you intend to express annotation-driven injection by name, do not primarily use @Autowired, even if it is capable of selecting by bean name among type-matching candidates. Instead, use the JSR-250 @Resource annotation, which is semantically defined to identify a specific target component by its unique name, with the declared type being irrelevant for the matching process. @Autowired has rather different semantics: After selecting candidate beans by type, the specified String qualifier value is considered within those type-selected candidates only (for example, matching an account qualifier against beans marked with the same qualifier label).</p>
<p style="font-size: 20px; line-height: 38px;">For beans that are themselves defined as a collection, Map, or array type, @Resource is a fine solution, referring to the specific collection or array bean by unique name. That said, as of 4.3, collection, you can match Map, and array types through Spring’s @Autowired type matching algorithm as well, as long as the element type information is preserved in @Bean return type signatures or collection inheritance hierarchies. In this case, you can use qualifier values to select among same-typed collections, as outlined in the previous paragraph.</p>
<p style="font-size: 20px; line-height: 38px;">As of 4.3, @Autowired also considers self references for injection (that is, references back to the bean that is currently injected). Note that self injection is a fallback. Regular dependencies on other components always have precedence. In that sense, self references do not participate in regular candidate selection and are therefore in particular never primary. On the contrary, they always end up as lowest precedence. In practice, you should use self references as a last resort only (for example, for calling other methods on the same instance through the bean’s transactional proxy). Consider factoring out the effected methods to a separate delegate bean in such a scenario. Alternatively, you can use @Resource, which may obtain a proxy back to the current bean by its unique name.</p>
<p style="font-size: 20px; line-height: 38px;">@Autowired applies to fields, constructors, and multi-argument methods, allowing for narrowing through qualifier annotations at the parameter level. In contrast, @Resource is supported only for fields and bean property setter methods with a single argument. As a consequence, you should stick with qualifiers if your injection target is a constructor or a multi-argument method.</p>
</blockquote>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;">简单的说就是：</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>@Resource 默认按 byName 自动注入。</strong>  既不指定 name 属性，也不指定 type 属性，则自动按 byName 方式进行查找。如果没有找到符合的 Bean，则回退为一个原始类型进行进行查找，如果找到就注入。  只是指定了@Resource 注解的 name，则按 name 后的名字去 Bean 元素里查找有与之相等的 name 属性的 bean。  只指定@Resource 注解的 type 属性，则从上下文中找到类型匹配的唯一 Bean 进行装配，找不到或者找到多个，都会抛出异常。</p>
</div><div class="cl-preview-section"><p style="font-size: 20px; line-height: 38px;"><strong>@Autowired 默认先按 byType 进行匹配</strong>，如果发现找到多个 Bean，则又按照 byName 方式进行匹配，如果还有多个，则报出异常。</p>
</div>}
                        </div>
                    </div>
                                            <!-- 买过的阅读 -->
                        <div class="art-next-prev clearfix">
                                                                                                <!-- 已买且开放 或者可以试读 -->
                                    <a href="/read/77/article/2033">
                                                                    <div class="prev l clearfix">
                                        <div class="icon l">
                                            <i class="imv2-arrow3_l"></i>
                                        </div>
                                        <p>
                                            19 Spring MVC应用拓展Resource应用于文件下载
                                        </p>
                                    </div>
                                </a>
                                                                                                                            <!-- 已买且开放 或者可以试读 -->
                                    <a href="/read/77/article/2035">
                                                                    <div class="next r clearfix">
                                        <p>
                                            21 Resource总结
                                        </p>
                                        <div class="icon r">
                                            <i class="imv2-arrow3_r"></i>
                                        </div>

                                    </div>
                                </a>
                                                    </div>
                                    </div>
                <div class="comments-con js-comments-con" id="coments_con">
                </div>

                
            </div>
            
            
            

        </div>
    </div>
</div>

<div class="modal modal-jiaQun-new hide" id="modal-jiaQun">
    <div class="inner" style="">
        <div class="modal-close js-close-jiaQun">
            <i class="imv2-close"></i>
        </div>
        <div class="content">
            <img src="https://img1.sycdn.imooc.com/5f1a80010001c9a105340522.jpg">
            <div class="right-info">
                <div class="title">
                    扫码加入慕课Java核心用户群
                </div>
                <div class="desc">
                                            <p class="mb6">验证信息：<span id="joincode">2011161431052393</span><span class="copy js-copy-joincode">复制</span></p>
                                        <p class="mb6">QQ讨论群号：314316732</p>
                                            <p>QQ群URL：<a href="https://jq.qq.com/?_wv=1027&amp;k=OouwHZGZ" target="_blank">点击访问</a></p>
                                    </div>
            </div>
            <p class="tip">若遇到搜索不到QQ群或加群失败，请联系客服邮箱:kf@imooc.com</p>
        </div>
    </div>
</div>
 
<!-- 专栏介绍页专栏评价 -->

<!-- 专栏介绍页底部三条评价 -->

<!-- 专栏阅读页弹层目录和介绍页页面目录 -->

<!-- 专栏阅读页发布回复 -->

<!-- 专栏阅读页发布评论 -->

<!-- 专栏阅读页底部评论 -->

<!-- 专栏阅读 单个 评论 -->

<!-- 新增回复和展开三条以外回复 -->

<!-- 立即订阅的弹窗 -->












</div></body></html>